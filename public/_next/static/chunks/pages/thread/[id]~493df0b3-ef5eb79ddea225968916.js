_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[54],{"/Ugf":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n("rB9j"),n("UxlC");function i(e){return e.replace(/(<\/?.+?\/?>)|\n/g,"")}},JMpY:function(e,t,n){"use strict";n("sMBO");var i,a=n("nKUr"),r=n("lwsE"),s=n.n(r),o=n("W8MJ"),c=n.n(o),l=n("7W2i"),u=n.n(l),d=n("a1gu"),p=n.n(d),h=n("Nsbk"),v=n.n(h),m=n("q1tI"),f=n.n(m),j=n("MCNy"),b=n.n(j),k=n("5f2u"),x=n.n(k),C=n("Bvw4"),y=n("l/UT"),O=n("+Lwc"),D=n("kMSe"),w=n("TSYQ"),g=n.n(w);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=v()(e);if(t){var a=v()(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return p()(this,n)}}var R=Object(D.c)("thread")(i=Object(D.d)(i=function(e){u()(n,e);var t=N(n);function n(e){var i;return s()(this,n),(i=t.call(this,e)).user=i.props.user||{},i}return c()(n,[{key:"onFollowClick",value:function(){"function"===typeof this.props.onFollowClick&&this.props.onFollowClick()}},{key:"onPrivateLetter",value:function(){"function"===typeof this.props.onPrivateLetter&&this.props.onPrivateLetter()}},{key:"onPersonalPage",value:function(){"function"===typeof this.props.onPersonalPage&&this.props.onPersonalPage()}},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{className:y.a.container,children:[Object(a.jsx)("div",{className:y.a.header,children:Object(a.jsx)("span",{children:"\u697c\u4e3b"})}),Object(a.jsxs)("div",{className:y.a.info,children:[Object(a.jsxs)("div",{className:y.a.AuthorInfo,children:[Object(a.jsx)("div",{className:y.a.avatar,children:Object(a.jsx)(C.a,{image:this.user.avatarUrl,name:this.user.nickname,circle:!0,userId:this.user.id,platform:"pc",onClick:function(){return e.onPersonalPage()}})}),Object(a.jsxs)("div",{className:y.a.information,children:[Object(a.jsx)("div",{className:y.a.name,onClick:function(){return e.onPersonalPage()},children:this.user.nickname||""}),Object(a.jsxs)("div",{className:y.a.dynamic,children:["\u6d3b\u8dc3\u5728 ",Object(O.a)(this.user.updatedAt)]})]})]}),Object(a.jsxs)("div",{className:y.a.theme,children:[Object(a.jsxs)("div",{className:y.a.themeInfo,children:[Object(a.jsx)("div",{className:y.a.title,children:"\u4e3b\u9898"}),Object(a.jsx)("div",{className:y.a.number,children:this.user.threadCount})]}),Object(a.jsxs)("div",{className:y.a.themeInfo,children:[Object(a.jsx)("div",{className:y.a.title,children:"\u70b9\u8d5e"}),Object(a.jsx)("div",{className:y.a.number,children:this.user.likedCount})]}),Object(a.jsxs)("div",{className:y.a.themeInfo,children:[Object(a.jsx)("div",{className:y.a.title,children:"\u5df2\u5173\u6ce8"}),Object(a.jsx)("div",{className:y.a.number,children:this.user.followCount})]}),Object(a.jsxs)("div",{className:y.a.themeInfo,children:[Object(a.jsx)("div",{className:y.a.title,children:"\u7c89\u4e1d"}),Object(a.jsx)("div",{className:y.a.number,children:this.user.fansCount})]})]})]}),this.props.isShowBtn?Object(a.jsxs)("div",{className:y.a.btn,children:[!this.user.follow&&Object(a.jsx)(x.a,{type:"primary",className:y.a.follow,onClick:function(){return e.onFollowClick()},children:Object(a.jsxs)("div",{className:y.a.btnItem,children:[Object(a.jsx)(b.a,{name:"PlusOutlined",size:"14",className:y.a.btnIcon}),Object(a.jsx)("span",{children:"\u5173\u6ce8"})]})}),1===this.user.follow&&Object(a.jsx)(x.a,{type:"primary",className:g()(y.a.follow,y.a["is-followed"]),onClick:function(){return e.onFollowClick()},children:Object(a.jsxs)("div",{className:y.a.btnItem,children:[Object(a.jsx)(b.a,{name:"CheckOutlined",size:"14",className:y.a.btnIcon}),Object(a.jsx)("span",{children:"\u5df2\u5173\u6ce8"})]})}),2===this.user.follow&&Object(a.jsx)(x.a,{type:"primary",className:g()(y.a.follow,y.a["with-followed"]),onClick:function(){return e.onFollowClick()},children:Object(a.jsxs)("div",{className:y.a.btnItem,children:[Object(a.jsx)(b.a,{name:"WithdrawOutlined",size:"14",className:y.a.btnIcon}),Object(a.jsx)("span",{children:"\u4e92\u5173"})]})}),Object(a.jsx)(x.a,{className:y.a.privateLetter,onClick:function(){return e.onPrivateLetter()},children:Object(a.jsxs)("div",{className:y.a.btnItem,children:[Object(a.jsx)(b.a,{name:"CommentOutlined",size:"14",className:y.a.btnIcon}),Object(a.jsx)("span",{children:"\u53d1\u79c1\u4fe1"})]})})]}):""]})}}]),n}(f.a.Component))||i)||i;t.a=R},L0er:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n("nKUr"),a=n("q1tI"),r=n("no3E"),s=n("5f2u"),o=n.n(s),c=n("z8Av");function l(e){var t=Object(a.useState)(e.text||"\u670d\u52a1\u5668\u9519\u8bef SERVER ERROR")[0];return Object(i.jsxs)("div",{className:r.a.page,children:[Object(i.jsx)(c.a,{}),Object(i.jsxs)("div",{className:r.a.body,children:[Object(i.jsx)("img",{className:r.a.icon,src:"/dzq-img/error.png"}),Object(i.jsx)("span",{className:r.a.text,children:t})]}),Object(i.jsx)("div",{className:r.a.footer,children:Object(i.jsx)(o.a,{onClick:function(){window.location.reload()},className:r.a.button,type:"primary",children:"\u70b9\u6211\u5237\u65b0"})})]})}},"TP+V":function(e,t,n){"use strict";n.r(t);n("ma9I"),n("QWBl"),n("yXV3"),n("oVuX"),n("qePV"),n("rB9j"),n("Rm1S"),n("UxlC"),n("FZtP");var i=n("nKUr"),a=n("o0o1"),r=n.n(a),s=(n("ls82"),n("yXPU")),o=n.n(s),c=n("lwsE"),l=n.n(c),u=n("W8MJ"),d=n.n(u),p=n("7W2i"),h=n.n(p),v=n("a1gu"),m=n.n(v),f=n("Nsbk"),j=n.n(f),b=n("q1tI"),k=n.n(b),x=n("20a2"),C=n("kMSe"),y=n("sho3"),O=(n("TeQF"),n("2B1R"),n("hByQ"),n("R5XZ"),n("lSNA")),D=n.n(O),w=n("B5JU"),g=n.n(w),N=n("B5zU"),R=n("HgT0"),P=(n("ACYA"),n("TSYQ")),I=n.n(P);var S,L=n("wrmh"),T=n("MCNy"),E=n.n(T),A=n("DetZ"),M=n.n(A),V=n("wdT/"),F=n.n(V),B=n("z8Av"),W=n("IvHc"),z=n("woGs"),U=n("33mu"),_=function(e){var t=e.showContent,n=e.setTop;return Object(i.jsxs)("div",{className:"".concat(U.a.setTop," ").concat(n?U.a.inTop:U.a.outTop),children:[Object(i.jsx)("span",{className:U.a.setTopIcon,children:Object(i.jsx)(E.a,{className:U.a.icon,name:"CheckOutlined"})}),t?"\u7f6e\u9876\u6210\u529f":"\u5df2\u53d6\u6d88\u7f6e\u9876"]})},q=n("aIz1"),G=n("c7hV"),H=n("iVyX"),K=n("dQ0f"),X=n("TibX"),J=n("z6Ap"),Q=n("rOX+"),Y=n.n(Q),Z=n("fkjL"),$=n("k8W2"),ee=n.n($),te=n("5f2u"),ne=n.n(te),ie=n("x2xJ"),ae=n.n(ie),re=n("/G68"),se=n("lY1M"),oe=function(e){var t=e.visible,n=e.onOkClick,a=Object(b.useState)(""),s=a[0],c=a[1];Object(b.useEffect)((function(){c("")}),[t]);var l=function(){"function"===typeof(null===e||void 0===e?void 0:e.onCancel)&&e.onCancel()},u=function(){var e=o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(""===s||Number(s)<=0||Number(s)>1e6)){e.next=4;break}return(""===s||Number(s)<=0)&&F.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u4e3a0"}),Number(s)>1e6&&F.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7100\u4e07"}),e.abrupt("return");case 4:if("function"!==typeof n){e.next=16;break}return e.prev=6,e.next=9,n(s);case 9:e.sent&&c(""),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(){return e.apply(this,arguments)}}(),d=function(){se.b.env("ios")&&setTimeout((function(){return function(){var e=document.body.scrollHeight;window.scrollTo(0,e)}()}),100)};return Object(i.jsx)(ee.a,{position:"bottom",visible:t,onClose:l,children:Object(i.jsxs)("div",{className:re.a.container,children:[Object(i.jsx)("div",{className:re.a.header,children:"\u652f\u4ed8\u4f5c\u8005\u7ee7\u7eed\u521b\u4f5c"}),Object(i.jsxs)("div",{className:re.a.rewardInput,children:[Object(i.jsx)("span",{className:re.a.prepend,children:"\u652f\u4ed8\u91d1\u989d"}),Object(i.jsx)(M.a,{mode:"number",placeholder:"\u91d1\u989d",className:re.a.input,value:s,onChange:function(e){return function(e){var t=e.match(/([1-9]\d{0,6}|0)(\.\d{0,2})?/);c(t?t[0]:"")}(e.target.value)},onFocus:function(){return d()}}),Object(i.jsx)("span",{className:re.a.append,children:"\u5143"})]}),Object(i.jsx)("div",{className:re.a.rewardList,children:[1,2,5,10,20,50,88,128].map((function(e){return Object(i.jsxs)("div",{onClick:function(){return function(e){c(e)}(e)},className:I()(re.a.reward,Number(s)===e&&re.a.actived),children:["\uffe5",e]},e)}))}),Object(i.jsx)(ae.a,{className:re.a.divider}),Object(i.jsxs)("div",{className:re.a.button,children:[Object(i.jsx)(ne.a,{onClick:l,className:re.a.cancel,type:"default",children:"\u53d6\u6d88"}),Object(i.jsx)(ne.a,{onClick:u,className:re.a.ok,type:"primary",children:"\u786e\u5b9a"})]})]})})},ce=n("kjBj"),le=n("RiVy"),ue=(n("sMBO"),n("5MUC")),de=n("RGe9"),pe=n("NOng"),he=n("HLiX"),ve=n("Hg/G"),me=n("JMBi"),fe=n("f5Uc"),je=(n("pNMO"),n("4Brf"),n("07d7"),n("9p2j"),n("zzKd"),Symbol("\u7ea2\u5305"),Symbol("\u8d4f\u91d1"),n("fEx9")),be=n("W7Eq"),ke=(n("lW1z"),n("JuNc")),xe=n("zBpv"),Ce=n("uYGS"),ye=n("bJLh"),Oe=n("CVCv"),De=function(e){var t=e.onClose,n=void 0===t?function(){}:t,a=e.money,r=void 0===a?"0.00":a,s=Object(b.useState)(!1),o=s[0],c=s[1],l=Object(b.useRef)(null),u=function(){document.querySelector("#button").style="transform: rotateY(360deg); visibility: hidden",document.querySelector("#open").style.visibility="hidden",document.querySelector("#moneyText").style="opacity: 1",c(!0)};return Object(i.jsxs)("div",{className:Oe.a.masking,onClick:function(e){"function"===typeof n&&o&&n()},ref:l,children:[Object(i.jsxs)("div",{className:Oe.a.container,onClick:function(e){return e.stopPropagation()},children:[Object(i.jsxs)("div",{className:Oe.a.moneyText,id:"moneyText",children:[Object(i.jsx)("div",{className:Oe.a.text,children:"\u606d\u559c\u60a8\uff0c\u9886\u5230\u4e86"}),Object(i.jsxs)("div",{className:Oe.a.money,children:[r,"\u5143"]})]}),Object(i.jsx)("div",{className:Oe.a.button,id:"button",onClick:u,children:Object(i.jsx)("div",{className:Oe.a.open,id:"open",children:"\u5f00"})}),Object(i.jsx)("img",{src:"https://imgcache.qq.com/operation/dianshi/other/up.01d1a47e41389411f01d143867134d93e0678512.png",id:"up",className:I()(Oe.a.up,D()({},Oe.a.animationUp,o))}),Object(i.jsx)("img",{src:"https://imgcache.qq.com/operation/dianshi/other/bottom.5e276e5e63dc355cea9ad803dbc2bc6169acc0ed.gif",id:"bottom",className:I()(Oe.a.bottom,D()({},Oe.a.animationBottom,o))})]}),Object(i.jsx)("div",{className:Oe.a.button,id:"button",onClick:u,children:Object(i.jsx)("div",{className:Oe.a.open,id:"open",children:"\u5f00"})})]})},we=n("4x5+"),ge=n.n(we),Ne=Object(C.c)("site","user")(Object(C.d)((function(e){var t,n,a,s,c,l,u,d,p,h,v,m,f,j,k,x,C,y,O,D,w,g,N,R,P,S,L,T,A,M,V,F,B,W,z,U,_,q,G,H,K,J,Q,Y,Z,$,ee,te,ie,ae,re,se,oe,ce,le,Oe,we,Ne=e.store,Re=e.site,Pe=(null===Ne||void 0===Ne||null===(t=Ne.threadData)||void 0===t?void 0:t.content)||{},Ie=Pe.text,Se=Pe.indexes,Le=null===Ne||void 0===Ne?void 0:Ne.threadData,Te=Le.parentCategoryName,Ee=Le.categoryName,Ae=Ne.hasRedPacket,Me={postId:null===Ne||void 0===Ne||null===(n=Ne.threadData)||void 0===n?void 0:n.postId,threadId:null===Ne||void 0===Ne||null===(a=Ne.threadData)||void 0===a?void 0:a.threadId,platform:"h5",payType:null===Ne||void 0===Ne||null===(s=Ne.threadData)||void 0===s?void 0:s.payType},Ve=1===((null===Ne||void 0===Ne||null===(c=Ne.threadData)||void 0===c?void 0:c.isApproved)||0),Fe=(null===Ne||void 0===Ne||null===(l=Ne.threadData)||void 0===l||null===(u=l.displayTag)||void 0===u?void 0:u.isEssence)||!1,Be=0===(null===Ne||void 0===Ne||null===(d=Ne.threadData)||void 0===d?void 0:d.payType),We=2===(null===Ne||void 0===Ne||null===(p=Ne.threadData)||void 0===p?void 0:p.payType)&&!1===(null===Ne||void 0===Ne||null===(h=Ne.threadData)||void 0===h?void 0:h.paid),ze=(null===Ne||void 0===Ne||null===(v=Ne.threadData)||void 0===v?void 0:v.attachmentPrice)||0,Ue=!Ye&&We&&!He&&!Ge,_e=1===(null===Ne||void 0===Ne||null===(m=Ne.threadData)||void 0===m?void 0:m.payType),qe=(null===Ne||void 0===Ne||null===(f=Ne.threadData)||void 0===f?void 0:f.price)||0,Ge=!0===(null===Ne||void 0===Ne||null===(j=Ne.threadData)||void 0===j?void 0:j.paid),He=(1===(null===Ne||void 0===Ne||null===(k=Ne.threadData)||void 0===k?void 0:k.payType)&&(null===Ne||void 0===Ne||null===(x=Ne.threadData)||void 0===x||x.paid),(null===(C=e.user)||void 0===C||null===(y=C.userInfo)||void 0===y?void 0:y.id)&&(null===(O=e.user)||void 0===O||null===(D=O.userInfo)||void 0===D?void 0:D.id)===(null===Ne||void 0===Ne||null===(w=Ne.threadData)||void 0===w?void 0:w.userId)),Ke=null===Ne||void 0===Ne||null===(g=Ne.threadData)||void 0===g||null===(N=g.displayTag)||void 0===N?void 0:N.isRedPack,Xe=null===Ne||void 0===Ne||null===(R=Ne.threadData)||void 0===R||null===(P=R.displayTag)||void 0===P?void 0:P.isReward,Je=Be&&(null===Ne||void 0===Ne||null===(S=Ne.threadData)||void 0===S?void 0:S.ability.canBeReward)&&!Ke&&!Xe,Qe=null===Ne||void 0===Ne||null===(L=Ne.threadData)||void 0===L?void 0:L.isReward,Ye=null===Ne||void 0===Ne||null===(T=Ne.threadData)||void 0===T?void 0:T.ability.canFreeViewPost,Ze=Object(ue.a)(Se);1===(null===(A=Ze.RED_PACKET)||void 0===A?void 0:A.condition)&&Ne.getRedPacketInfo(Ze.RED_PACKET.threadId);var $e=function(){var t=o()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"function"===typeof e.onPayClick&&e.onPayClick();case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),et=function(){"function"===typeof e.onRewardClick&&e.onRewardClick()};Object(b.useEffect)((function(){var t;(null===(t=Ze.IMAGE)||void 0===t?void 0:t.length)!==Ne.contentImgLength&&Ze.IMAGE||e.setContentImgReady()}),[Ne.contentImgLength]);var tt=(null===Ne||void 0===Ne||null===(M=Ne.threadData)||void 0===M?void 0:M.ability)||{},nt=tt.canDownloadAttachment,it=tt.canViewAttachment,at=tt.canViewVideo;return Object(i.jsxs)("div",{className:"".concat(xe.a.container),children:[Object(i.jsxs)("div",{className:xe.a.header,children:[Object(i.jsx)("div",{className:xe.a.userInfo,children:Object(i.jsx)(ke.a,{name:(null===Ne||void 0===Ne||null===(V=Ne.threadData)||void 0===V||null===(F=V.user)||void 0===F?void 0:F.nickname)||"",avatar:(null===Ne||void 0===Ne||null===(B=Ne.threadData)||void 0===B||null===(W=B.user)||void 0===W?void 0:W.avatar)||"",location:(null===Ne||void 0===Ne||null===(z=Ne.threadData)||void 0===z?void 0:z.position.location)||"",groupName:(null===Ne||void 0===Ne||null===(U=Ne.threadData)||void 0===U||null===(_=U.group)||void 0===_?void 0:_.groupName)||"",view:"".concat(null===Ne||void 0===Ne||null===(q=Ne.threadData)||void 0===q?void 0:q.viewCount)||"",time:"".concat(null===Ne||void 0===Ne||null===(G=Ne.threadData)||void 0===G?void 0:G.diffTime)||"",isEssence:Fe,isPay:!Be,isReward:Xe,isRed:Ke,userId:null===Ne||void 0===Ne||null===(H=Ne.threadData)||void 0===H||null===(K=H.user)||void 0===K?void 0:K.userId,onClick:function(t){"function"===typeof e.onUserClick&&e.onUserClick(t)}})}),(null===e||void 0===e||null===(J=e.user)||void 0===J?void 0:J.isLogin())&&Ve&&Object(i.jsx)("div",{className:xe.a.more,onClick:function(){e.fun.moreClick()},children:Object(i.jsx)(E.a,{size:20,color:"#8590A6",name:"MoreVOutlined"})})]}),Object(i.jsxs)("div",{className:xe.a.body,children:[(null===Ne||void 0===Ne||null===(Q=Ne.threadData)||void 0===Q?void 0:Q.title)&&Object(i.jsx)("div",{className:xe.a.title,children:null===Ne||void 0===Ne||null===(Y=Ne.threadData)||void 0===Y?void 0:Y.title}),Ie&&Object(i.jsx)(he.a,{needShowMore:!1,content:Ie||""}),Ze.VIDEO&&Object(i.jsx)(me.a,{url:Ze.VIDEO.mediaUrl,coverUrl:Ze.VIDEO.coverUrl,v_height:Ze.VIDEO.height||null,v_width:Ze.VIDEO.width||null,status:Ze.VIDEO.status,canViewVideo:at}),Ze.IFRAME&&Object(i.jsx)(Ce.a,{content:Ze.IFRAME.content}),Ze.IMAGE&&Object(i.jsx)(de.a,{postLoad:function(){Ne.setContentImgLength()},flat:!0,platform:"h5",imgData:Ze.IMAGE,isPay:Ue,onPay:$e}),(Ze.RED_PACKET||Ze.REWARD)&&Object(i.jsxs)("div",{className:xe.a.reward,children:[Ze.REWARD&&Object(i.jsxs)("div",{className:xe.a.rewardBody,style:{width:"100%"},children:[Object(i.jsx)(ye.a,{type:1,money:Ze.REWARD.money,remainMoney:Ze.REWARD.remainMoney}),Object(i.jsxs)("div",{className:xe.a.rewardText,children:[Object(i.jsxs)("div",{className:xe.a.rewardMoney,children:["\u672c\u5e16\u5411\u6240\u6709\u4eba\u60ac\u8d4f",Object(i.jsx)("span",{className:xe.a.rewardNumber,children:Ze.REWARD.money||0}),"\u5143"]}),Object(i.jsxs)("div",{className:xe.a.rewardTime,children:[Ze.REWARD.expiredAt,"\u622a\u6b62\u60ac\u8d4f"]})]})]}),Ze.RED_PACKET&&Object(i.jsxs)("div",{style:{width:"100%"},children:[Object(i.jsx)(ye.a,{number:Ze.RED_PACKET.number,remainNumber:Ze.RED_PACKET.remainNumber,condition:Ze.RED_PACKET.condition}),!!Ze.RED_PACKET.condition&&Object(i.jsxs)("div",{className:xe.a.redPacketLikeNum,children:["\u8bc4\u8bba\u96c6",Ze.RED_PACKET.likenum,"\u8d5e\u9886\u7ea2\u5305"]})]})]}),Ze.GOODS&&Object(i.jsxs)("div",{children:[Object(i.jsx)(ve.a,{image:Ze.GOODS.imagePath,amount:Ze.GOODS.price,title:Ze.GOODS.title,className:xe.a.product}),Object(i.jsxs)(ne.a,{className:xe.a.buyBtn,type:"danger",onClick:function(){var e;(e=Ze.GOODS.detailContent)&&window.open(e)},children:[Object(i.jsx)(E.a,{className:xe.a.payIcon,name:"ShoppingCartOutlined",size:20}),Object(i.jsx)("span",{className:xe.a.buyText,children:"\u8d2d\u4e70\u5546\u54c1"})]})]}),Ze.VOICE&&Object(i.jsx)(pe.a,{url:Ze.VOICE.mediaUrl}),Ze.VOTE&&Object(i.jsx)(be.a,{attachments:Ze.VOTE,threadId:null===Ne||void 0===Ne||null===(Z=Ne.threadData)||void 0===Z?void 0:Z.threadId,canDownloadAttachment:nt,canViewAttachment:it}),Ze.VOTE_THREAD&&Object(i.jsx)(fe.a,{voteData:Ze.VOTE_THREAD,threadId:null===Ne||void 0===Ne||null===($=Ne.threadData)||void 0===$?void 0:$.threadId,page:"detail"}),Ue&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:$e,children:Object(i.jsxs)(ne.a,{className:xe.a.payButton,type:"primary",children:[Object(i.jsx)(E.a,{className:xe.a.payIcon,name:"GoldCoinOutlined",size:16}),Object(i.jsxs)("p",{children:["\u652f\u4ed8",ze,"\u5143\u67e5\u770b\u9644\u4ef6\u5185\u5bb9"]})]})}),ge.a.injection("plugin_detail","thread_extension_display_hook").map((function(e){var t=e.render,n=e.pluginInfo;return Object(i.jsx)("div",{children:t({site:Re,renderData:Ze.plugin})},n.name)})),(Te||Ee)&&Object(i.jsx)("div",{className:xe.a.tag,onClick:function(){"function"===typeof e.onTagClick&&e.onTagClick()},children:Te?"".concat(Te,"/").concat(Ee):Ee}),!Ye&&_e&&!He&&!Ge&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:$e,children:Object(i.jsxs)(ne.a,{className:xe.a.payButton,type:"primary",children:[Object(i.jsx)(E.a,{className:xe.a.payIcon,name:"GoldCoinOutlined",size:16}),"\u652f\u4ed8",qe,"\u5143\u67e5\u770b\u5269\u4f59\u5185\u5bb9"]})}),Object(i.jsx)("div",{className:xe.a.rewardContianer,children:Object(i.jsxs)(ne.a,{onClick:et,className:xe.a.rewardButton,type:"primary",children:[Object(i.jsx)(E.a,{className:xe.a.payIcon,name:"HeartOutlined",size:20}),Object(i.jsx)("span",{className:xe.a.rewardext,children:"\u6253\u8d4f"})]})})]}),Ve&&Object(i.jsxs)("div",{className:xe.a.footer,children:[Object(i.jsxs)("div",{className:xe.a.thumbs,children:[_e&&Object(i.jsx)(E.a,{className:I()(xe.a.payIcon,Ge&&xe.a.actived),name:"GoldCoinOutlined",size:20}),Je&&Object(i.jsx)(E.a,{onClick:function(){return!He&&et()},className:I()(xe.a.payIcon,Qe&&xe.a.actived),name:"HeartOutlined",size:20}),Object(i.jsxs)("div",{className:I()(xe.a.liked,(null===Ne||void 0===Ne||null===(ee=Ne.threadData)||void 0===ee?void 0:ee.isLike)&&xe.a.actived),onClick:Object(X.a)((function(){"function"===typeof e.onLikeClick&&e.onLikeClick()}),500),children:[Object(i.jsx)(E.a,{name:"LikeOutlined",size:20}),(null===Ne||void 0===Ne||null===(te=Ne.threadData)||void 0===te||null===(ie=te.likeReward)||void 0===ie?void 0:ie.likePayCount)>0&&Object(i.jsx)("span",{className:xe.a.likedNumber,children:(null===Ne||void 0===Ne||null===(ae=Ne.threadData)||void 0===ae||null===(re=ae.likeReward)||void 0===re?void 0:re.likePayCount)||""})]}),Object(i.jsx)("div",{className:xe.a.likeReward,children:Object(i.jsx)(je.a,{tipData:Me,imgs:(null===Ne||void 0===Ne||null===(se=Ne.threadData)||void 0===se||null===(oe=se.likeReward)||void 0===oe?void 0:oe.users)||[],showMore:!0,showCount:5,platform:"h5"})})]}),(null===Ne||void 0===Ne||null===(ce=Ne.threadData)||void 0===ce||null===(le=ce.likeReward)||void 0===le?void 0:le.shareCount)>0&&Object(i.jsxs)("div",{className:xe.a.shareCount,children:[null===Ne||void 0===Ne||null===(Oe=Ne.threadData)||void 0===Oe||null===(we=Oe.likeReward)||void 0===we?void 0:we.shareCount,"\u6b21\u5206\u4eab"]})]}),Ae>0&&Object(i.jsx)(De,{onClose:function(){return Ne.setRedPacket(0)},money:Ae})]})}))),Re=(n("ToJy"),n("7mQc")),Pe=n("X3A+"),Ie=n("iJKD");function Se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var a=j()(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return m()(this,n)}}var Le=Object(C.c)("thread")(S=Object(C.c)("comment")(S=Object(C.c)("commentPosition")(S=Object(C.c)("user")(S=Object(C.c)("site")(S=Object(C.d)(S=function(e){h()(n,e);var t=Se(n);function n(e){var i;return l()(this,n),(i=t.call(this,e)).onSortClick=o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!==typeof i.props.sort){e.next=11;break}return e.prev=1,e.next=4,i.props.sort(!i.state.commentSort);case 4:e.sent&&i.setState({commentSort:!i.state.commentSort}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),i.state={showAboptPopup:!1,showCommentInput:!1,commentSort:!0,showDeletePopup:!1,showReplyDeletePopup:!1,inputText:"\u8bf7\u8f93\u5165\u5185\u5bb9"},i.commentData=null,i.replyData=null,i.recordCommentLike={id:null,status:null},i.recordReplyLike={id:null,status:null},i}return d()(n,[{key:"likeClick",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:if(t.id){e.next=6;break}return e.abrupt("return");case 6:if(this.recordCommentLike.id!==t.id&&(this.recordCommentLike.status=null),this.recordCommentLike.status===t.isLiked){e.next=12;break}this.recordCommentLike.status=t.isLiked,this.recordCommentLike.id=t.id,e.next=13;break;case 12:return e.abrupt("return");case 13:return n={id:t.id,isLiked:!t.isLiked},e.next=16,this.props.comment.updateLiked(n,this.props.thread);case 16:i=e.sent,a=i.success,s=i.msg,a&&(this.props.isPositionComment?(this.props.commentPosition.setCommentListDetailField(t.id,"isLiked",n.isLiked),o=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setCommentListDetailField(t.id,"likeCount",o)):(this.props.thread.setCommentListDetailField(t.id,"isLiked",n.isLiked),c=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setCommentListDetailField(t.id,"likeCount",c))),a||F.a.error({content:s});case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replyLikeClick",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}return e.abrupt("return");case 2:if(this.props.user.isLogin()){e.next=6;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 6:if(this.recordReplyLike.id!==t.id&&(this.recordReplyLike.status=null),this.recordReplyLike.status===t.isLiked){e.next=12;break}this.recordReplyLike.status=t.isLiked,this.recordReplyLike.id=t.id,e.next=13;break;case 12:return e.abrupt("return");case 13:return i={id:t.id,isLiked:!t.isLiked},e.next=16,this.props.comment.updateLiked(i);case 16:a=e.sent,s=a.success,o=a.msg,this.props.isPositionComment?(this.props.commentPosition.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),c=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setReplyListDetailField(n.id,t.id,"likeCount",c)):(this.props.thread.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),l=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setReplyListDetailField(n.id,t.id,"likeCount",l)),s||F.a.error({content:o});case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteClick",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.commentData=t,this.setState({showDeletePopup:!0});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteComment",value:function(){var e=o()(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.commentData.id){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.props.comment.delete(this.commentData.id,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 4:if(t=e.sent,n=t.success,i=t.msg,this.setState({showDeletePopup:!1}),!n){e.next=11;break}return F.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 11:F.a.error({content:i});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyDeleteClick",value:function(){var e=o()(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.commentData=n,this.replyData=t,this.setState({showReplyDeletePopup:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"replyDeleteComment",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.replyData.id){e.next=2;break}return e.abrupt("return");case 2:return t={},this.replyData&&this.commentData&&(t.replyData=this.replyData,t.commentData=this.commentData),e.next=6,this.props.comment.deleteReplyComment(t,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 6:if(n=e.sent,i=n.success,a=n.msg,this.setState({showReplyDeletePopup:!1}),!i){e.next=13;break}return F.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 13:F.a.error({content:a});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyClick",value:function(e){var t,n;if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});if(this.props.canPublish("reply")){this.commentData=e,this.replyData=null;var i=(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.nickname)||(null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.userName);this.setState({showCommentInput:!0,inputText:i?"\u56de\u590d".concat(i):"\u8bf7\u8f93\u5165\u5185\u5bb9"})}}},{key:"replyReplyClick",value:function(e,t){var n,i;if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});if(this.props.canPublish("reply")){this.commentData=null,this.replyData=e,this.replyData.commentId=t.id;var a=(null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.nickname)||(null===e||void 0===e||null===(i=e.user)||void 0===i?void 0:i.userName);this.setState({showCommentInput:!0,inputText:a?"\u56de\u590d".concat(a):"\u8bf7\u8f93\u5165\u5185\u5bb9"})}}},{key:"createReply",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.length>0&&void 0!==p[0]?p[0]:"",a=p.length>1&&void 0!==p[1]?p[1]:[],i.replace(/\s/g,"")||0!==a.length){e.next=6;break}return F.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 6:if(s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id){e.next=9;break}return e.abrupt("return");case 9:return o={id:s,content:i},this.replyData&&(o.replyId=this.replyData.id,o.isComment=!0,o.commentId=this.replyData.commentId,o.commentPostId=this.replyData.id),this.commentData&&(o.replyId=this.commentData.id,o.isComment=!0,o.commentId=this.commentData.id),null!==a&&void 0!==a&&a.length&&(o.attachments=a.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=15,this.props.comment.createReply(o,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 15:if(c=e.sent,l=c.success,u=c.msg,d=c.isApproved,!l){e.next=23;break}return this.setState({showCommentInput:!1,inputValue:""}),d?F.a.success({content:u}):F.a.warning({content:u}),e.abrupt("return",!0);case 23:F.a.error({content:u});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"editClick",value:function(e){"function"===typeof this.props.onEditClick&&this.props.onEditClick(e)}},{key:"onCommentClick",value:function(e){var t,n,i,a;e.id&&null!==(t=this.props.thread)&&void 0!==t&&null!==(n=t.threadData)&&void 0!==n&&n.id&&this.props.router.push("/thread/comment/".concat(e.id,"?threadId=").concat(null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id))}},{key:"onAboptClick",value:function(e){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.commentData=e,this.setState({showAboptPopup:!0})}},{key:"onAboptOk",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=15;break}return s={postId:null===(n=this.commentData)||void 0===n?void 0:n.id,rewards:t,threadId:null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.threadId},e.next=4,this.props.thread.reward(s);case 4:if(o=e.sent,c=o.success,l=o.msg,!c){e.next=12;break}return this.setState({showAboptPopup:!1}),this.props.thread.fetchThreadDetail(s.threadId),F.a.success({content:"\u60ac\u8d4f".concat(t,"\u5143")}),e.abrupt("return",!0);case 12:F.a.error({content:l}),e.next=16;break;case 15:F.a.info({content:"\u60ac\u8d4f\u91d1\u989d\u4e0d\u80fd\u4e3a0"});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onAboptCancel",value:function(){this.commentData=null,this.setState({showAboptPopup:!1})}},{key:"avatarClick",value:function(e){var t=e.userId;t&&this.props.router.push("/user/".concat(t))}},{key:"replyAvatarClick",value:function(e,t,n){"function"===typeof this.props.replyAvatarClick&&this.props.replyAvatarClick(e,t,n)}},{key:"render",value:function(){var e,t,n,a,r,s,o,c,l,u,d,p,h,v,m=this,f=this.props.thread,j=f.totalCount,k=f.commentList,x=this.props.commentPosition,C=x.commentList,y=x.postId;this.props.isPositionComment&&(k=C||[]);var O=(null===(e=this.props.user)||void 0===e||null===(t=e.userInfo)||void 0===t?void 0:t.id)&&(null===(n=this.props.user)||void 0===n||null===(a=n.userInfo)||void 0===a?void 0:a.id)===(null===(r=this.props.thread)||void 0===r||null===(s=r.threadData)||void 0===s?void 0:s.userId),D=null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c||null===(l=c.displayTag)||void 0===l?void 0:l.isReward,w=((null===(u=this.props.thread)||void 0===u||null===(d=u.threadData)||void 0===d?void 0:d.content)||{}).indexes,g=((null===(p=this.props.thread)||void 0===p?void 0:p.threadData)||"").isAnonymous,N=Object(ue.a)(w);return Object(i.jsxs)(b.Fragment,{children:[this.props.showHeader&&Object(i.jsxs)("div",{className:Ie.a.header,children:[Object(i.jsxs)("div",{className:Ie.a.number,children:["\u5171",j,"\u6761\u8bc4\u8bba"]}),Object(i.jsxs)("div",{className:Ie.a.sort,onClick:function(){return m.onSortClick()},children:[Object(i.jsx)(E.a,{className:Ie.a.sortIcon,name:"SortOutlined"}),Object(i.jsx)("span",{className:Ie.a.sortText,children:this.state.commentSort?"\u8bc4\u8bba\u4ece\u65b0\u5230\u65e7":"\u8bc4\u8bba\u4ece\u65e7\u5230\u65b0"})]})]}),Object(i.jsx)("div",{className:Ie.a.body,children:k.map((function(e,t){var n,a,r,s;return Object(i.jsx)("div",{className:"".concat(Ie.a.commentItems," ").concat(t===k.length-1&&Ie.a.isLastOne),ref:e.id===y?m.props.positionRef:null,children:Object(i.jsx)(Re.a,{data:e,likeClick:Object(X.a)((function(){return m.likeClick(e)}),500),avatarClick:function(){return m.avatarClick(e)},replyClick:function(){return m.replyClick(e)},deleteClick:function(){return m.deleteClick(e)},editClick:function(){return m.editClick(e)},replyAvatarClick:function(t,n){return m.replyAvatarClick(t,e,n)},replyLikeClick:Object(X.a)((function(t){return m.replyLikeClick(t,e)}),500),replyReplyClick:function(t){return m.replyReplyClick(t,e)},replyDeleteClick:function(t){return m.replyDeleteClick(t,e)},onCommentClick:function(){return m.onCommentClick(e)},onAboptClick:function(){return m.onAboptClick(e)},isShowOne:!0,isShowAdopt:O&&D&&(null===(n=m.props.thread)||void 0===n||null===(a=n.threadData)||void 0===a?void 0:a.userId)!==e.userId,threadId:null===(r=m.props.thread)||void 0===r||null===(s=r.threadData)||void 0===s?void 0:s.userId,active:e.id===y,isAnonymous:g},e.id)},e.id||t)}))}),Object(i.jsx)(H.a,{visible:this.state.showCommentInput,inputText:this.state.inputText,onClose:function(){return m.setState({showCommentInput:!1})},onSubmit:function(e,t){return m.createReply(e,t)},site:this.props.site}),Object(i.jsx)(q.a,{visible:this.state.showDeletePopup,onClose:function(){return m.setState({showDeletePopup:!1})},onBtnClick:function(){return m.deleteComment()}}),Object(i.jsx)(q.a,{visible:this.state.showReplyDeletePopup,onClose:function(){return m.setState({showReplyDeletePopup:!1})},onBtnClick:function(){return m.replyDeleteComment()}}),(null===N||void 0===N||null===(h=N.REWARD)||void 0===h?void 0:h.money)&&(null===N||void 0===N||null===(v=N.REWARD)||void 0===v?void 0:v.remainMoney)&&Object(i.jsx)(Pe.a,{money:Number(N.REWARD.money),remainMoney:Number(N.REWARD.remainMoney),visible:this.state.showAboptPopup,onCancel:function(){return m.onAboptCancel()},onOkClick:function(e){return m.onAboptOk(e)}})]})}}]),n}(k.a.Component))||S)||S)||S)||S)||S)||S;Le.defaultProps={showHeader:!0};var Te,Ee=Le,Ae=n("QcND"),Me=n("ni5c"),Ve=n("wXCO"),Fe=n("FeKq");function Be(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var a=j()(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return m()(this,n)}}var We,ze=Object(C.c)("site")(Te=Object(C.c)("user")(Te=Object(C.c)("thread")(Te=Object(C.c)("commentPosition")(Te=Object(C.c)("comment")(Te=Object(C.c)("index")(Te=Object(C.c)("card")(Te=Object(C.c)("vlist")(Te=Object(C.d)(Te=function(e){h()(n,e);var t=Be(n);function n(e){var i,a,s;return l()(this,n),(s=t.call(this,e)).setContentImgReady=function(){s.setState({contentImgIsReady:!0})},s.onMoreClick=function(){s.setState({showMorePopup:!0})},s.onOperClick=function(e){if(!s.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});if(s.setState({showMorePopup:!1}),"stick"===e&&s.updateStick(),"essence"===e&&s.updateEssence(),"delete"===e&&s.setState({showDeletePopup:!0}),"edit"===e){var t,n,i,a;if(null===(t=s.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n||!n.id)return;s.props.router.push("/thread/post?id=".concat(null===(i=s.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id))}"report"===e&&s.setState({showReportPopup:!0}),"collect"===e&&s.onCollectionClick(),"wxshare"===e&&s.onShareClick(),"copylink"===e&&s.handleH5Share(),"post"===e&&s.createCard()},s.handleClick=function(){s.props.user.isLogin()?s.setState({show:!0}):Object(W.a)({url:"/user/login"})},s.onShareClose=function(){s.setState({show:!1})},s.handleH5Share=o()(r.a.mark((function e(){var t,n,i,a,o,c,l,u,d,p,h,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.a.info({content:"\u590d\u5236\u94fe\u63a5\u6210\u529f"}),s.onShareClose(),c=(null===(t=s.props.thread)||void 0===t?void 0:t.threadData)||{},l=c.title,u=void 0===l?"":l,Y()({title:u,path:"thread/".concat(null===(n=s.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.threadId)}),d=null===(a=s.props.thread)||void 0===a||null===(o=a.threadData)||void 0===o?void 0:o.id,e.next=7,s.props.thread.shareThread(d,s.props.index,s.props.search,s.props.topic);case 7:p=e.sent,h=p.success,v=p.msg,h||F.a.error({content:v});case 11:case"end":return e.stop()}}),e)}))),s.handleWxShare=function(){s.setState({isShowWeiXinShare:!0}),s.onShareClose(),s.onShareClick()},s.createCard=o()(r.a.mark((function e(){var t,n,i,a,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.props.thread.threadData,n=t.id,i=s.props.card,e.next=5,s.props.thread.shareThread(n,s.props.index,s.props.search,s.props.topic);case 5:a=e.sent,o=a.success,c=a.msg,o||F.a.error({content:c}),i.setThreadData(t),g.a.push({url:"/card?threadId=".concat(n)});case 11:case"end":return e.stop()}}),e)}))),s.state={loadWeiXin:!1,isShowWeiXinShare:!1,showReportPopup:!1,showDeletePopup:!1,showCommentInput:!1,showMorePopup:!1,showRewardPopup:!1,isCommentLoading:!1,setTop:!1,showContent:"",show:!1,stateFlag:!(null!==(i=s.props.thread)&&void 0!==i&&i.isPositionToComment),contentImgIsReady:!1},s.perPage=20,s.commentDataSort=!0,s.threadBodyRef=k.a.createRef(),s.commentDataRef=k.a.createRef(),s.position=0,s.nextPosition=0,s.flag=!(null!==(a=s.props.thread)&&void 0!==a&&a.isPositionToComment),s.isFirst=!0,s.comment=null,s.reportContent=["\u5e7f\u544a\u5783\u573e","\u8fdd\u89c4\u5185\u5bb9","\u6076\u610f\u704c\u6c34","\u91cd\u590d\u53d1\u5e16"],s.inputText="\u5176\u4ed6\u7406\u7531...",s.positionRef=k.a.createRef(),s.isPositioned=!1,s}return d()(n,[{key:"handleOnScroll",value:function(){var e,t,n,i,a,r,s,o,c=null===(e=this.threadBodyRef)||void 0===e||null===(t=e.current)||void 0===t?void 0:t.scrollTop,l=null===(n=this.threadBodyRef)||void 0===n||null===(i=n.current)||void 0===i?void 0:i.offsetHeight,u=null===(a=this.threadBodyRef)||void 0===a||null===(r=a.current)||void 0===r?void 0:r.scrollHeight,d=this.props.thread,p=d.isCommentReady,h=d.isNoMore;(this.props.thread.setScrollDistance(c),c+l>=u&&!this.state.isCommentLoading&&p&&!h&&(this.props.thread.setCommentListPage(this.props.thread.page+1),this.loadCommentList()),this.flag)&&(this.nextPosition=(null===(s=this.threadBodyRef)||void 0===s||null===(o=s.current)||void 0===o?void 0:o.scrollTop)||0)}},{key:"componentDidMount",value:function(){this.setState({loadWeiXin:Object(le.a)()})}},{key:"componentDidUpdate",value:function(){var e,t,n=this;if(this.isFirst){var i=this.props.thread;if(this.state.contentImgIsReady){var a,r,s,o;if(this.isFirst=!1,this.position=(null===(a=this.commentDataRef)||void 0===a||null===(r=a.current)||void 0===r?void 0:r.offsetTop)-50,i.clearContentImgState(),null!==(s=this.props)&&void 0!==s&&null!==(o=s.thread)&&void 0!==o&&o.isPositionToComment)return void setTimeout((function(){var e,t;null===(e=n.threadBodyRef)||void 0===e||null===(t=e.current)||void 0===t||t.scrollTo(0,n.position)}),1e3);this.threadBodyRef.current.scrollTo(0,this.props.thread.scrollDistance)}null!==(e=this.props.commentPosition)&&void 0!==e&&e.postId&&!this.isPositioned&&null!==(t=this.positionRef)&&void 0!==t&&t.current&&(this.isPositioned=!0,setTimeout((function(){n.positionRef.current.scrollIntoView()}),1e3))}}},{key:"componentWillUnmount",value:function(){}},{key:"onMessageClick",value:function(){var e=this.flag?this.position:0;this.flag=!this.flag,this.setState({stateFlag:this.flag}),this.threadBodyRef.current.scrollTo(0,e)}},{key:"onCollectionClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:return a=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:a,isFavorite:!(null!==(i=this.props.thread)&&void 0!==i&&i.isFavorite)},e.next=8,this.props.thread.updateFavorite(s);case 8:if(o=e.sent,c=o.success,l=o.msg,!c){e.next=14;break}return F.a.success({content:s.isFavorite?"\u6536\u85cf\u6210\u529f":"\u53d6\u6d88\u6536\u85cf"}),e.abrupt("return");case 14:F.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCommentList",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.props.thread.isCommentReady,!this.state.isCommentLoading&&i){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),a=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:a,page:this.props.thread.page,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.thread.loadCommentList(s);case 8:if(o=e.sent,c=o.success,l=o.msg,this.setState({isCommentLoading:!1}),!c){e.next=14;break}return e.abrupt("return",!0);case 14:F.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSortChange",value:function(e){return this.commentDataSort=e,this.props.thread.setCommentListPage(1),this.props.commentPosition.reset(),this.loadCommentList()}},{key:"onInputClick",value:function(){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.props.canPublish("reply")&&this.setState({showCommentInput:!0})}},{key:"onReportOk",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n={threadId:this.props.thread.threadData.threadId,type:1,reason:t,userId:this.props.user.userInfo.id},e.next=5,this.props.thread.createReports(n);case 5:if(i=e.sent,a=i.success,s=i.msg,!a){e.next=12;break}return F.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),this.setState({showReportPopup:!1}),e.abrupt("return",!0);case 12:F.a.error({content:s});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setTopState",value:function(e){var t=this;this.setState({showContent:e,setTop:!this.state.setTop}),setTimeout((function(){t.setState({setTop:!t.state.setTop})}),2e3)}},{key:"updateStick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,o={id:s,isStick:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(a=i.threadData)&&void 0!==a&&a.isStick)},e.next=4,this.props.thread.updateStick(o);case 4:if(c=e.sent,l=c.success,u=c.msg,!l){e.next=11;break}return this.setTopState(o.isStick),(null===(d=this.props)||void 0===d||null===(p=d.index)||void 0===p?void 0:p.refreshHomeData)&&this.props.index.refreshHomeData(),e.abrupt("return");case 11:F.a.error({content:u});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEssence",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,isEssence:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(a=i.threadData)&&void 0!==a&&null!==(s=a.displayTag)&&void 0!==s&&s.isEssence)},e.next=4,this.props.thread.updateEssence(c);case 4:if(l=e.sent,u=l.success,d=l.msg,this.props.thread.updateListStore(),!u){e.next=11;break}return F.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),e.abrupt("return");case 11:F.a.error({content:d});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showDeletePopup:!1}),i=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,e.next=4,this.props.thread.delete(i);case 4:if(a=e.sent,s=a.success,o=a.msg,!s){e.next=11;break}return F.a.success({content:"\u5220\u9664\u6210\u529f\uff0c\u5373\u5c06\u8df3\u8f6c\u81f3\u9996\u9875"}),setTimeout((function(){c.props.router.push("/")}),1e3),e.abrupt("return");case 11:F.a.error({content:o});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onBtnClick",value:function(){this.delete(),this.setState({showDeletePopup:!1})}},{key:"onPublishClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:"",n=i.length>1&&void 0!==i[1]?i[1]:[],t.replace(/\s/g,"")||0!==n.length){e.next=6;break}return F.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 6:if(!this.comment){e.next=12;break}return e.next=9,this.updateComment(t,n);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,this.createComment(t,n);case 14:e.t0=e.sent;case 15:return e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o,c,l,u,d,p,h,v,m,f,j;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id,l={id:c,content:t,sort:this.commentDataSort,isNoMore:null===(s=this.props)||void 0===s||null===(o=s.thread)||void 0===o?void 0:o.isNoMore,attachments:[]},null!==n&&void 0!==n&&n.length&&(l.attachments=n.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=5,this.props.comment.createComment(l,this.props.thread);case 5:if(u=e.sent,d=u.success,p=u.msg,h=u.isApproved,v=u.redPacketAmount,!d){e.next=19;break}return this.props.thread.updatePostCount(this.props.thread.totalCount),this.props.thread.updateListStore(),(null===(m=this.props.thread)||void 0===m||null===(f=m.threadData)||void 0===f||null===(j=f.displayTag)||void 0===j?void 0:j.isRedPack)&&this.props.thread.fetchThreadDetail(c),v&&v>0&&this.props.thread.setRedPacket(v),h?F.a.success({content:p}):F.a.warning({content:p}),this.setState({showCommentInput:!1}),e.abrupt("return",!0);case 19:F.a.error({content:p});case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateComment",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c,l,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.comment){e.next=2;break}return e.abrupt("return");case 2:return a=null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.id,s={id:a,postId:this.comment.id,content:t,attachments:[]},e.next=6,this.props.comment.updateComment(s,this.props.thread);case 6:if(o=e.sent,c=o.success,l=o.msg,u=o.isApproved,!c){e.next=14;break}return u?F.a.success({content:l}):F.a.warning({content:l}),this.setState({showCommentInput:!1}),e.abrupt("return",!0);case 14:F.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEditClick",value:function(e){this.comment=e,this.setState({inputValue:e.content,showCommentInput:!0})}},{key:"onClose",value:function(){this.setState({showCommentInput:!1}),this.comment=null}},{key:"onLikeClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:return c=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,l={id:c,pid:null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.postId,isLiked:!(null!==(s=this.props.thread)&&void 0!==s&&null!==(o=s.threadData)&&void 0!==o&&o.isLike)},e.next=8,this.props.thread.updateLiked(l,this.props.index,this.props.user);case 8:u=e.sent,d=u.success,p=u.msg,d||F.a.error({content:p});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onShareClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(le.a)()){e.next=2;break}return e.abrupt("return");case 2:return this.setState({isShowWeiXinShare:!0}),t=this.props.thread.threadData,n=t.id,e.next=7,this.props.thread.shareThread(n,this.props.index,this.props.search,this.props.topic);case 7:i=e.sent,a=i.success,s=i.msg,a||F.a.error({content:s});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onPayClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:return a=this.props.thread.threadData,e.next=7,Object(Z.a)(a,null===(t=this.props.user)||void 0===t?void 0:t.userInfo);case 7:if(s=e.sent,!s.success||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId){e.next=13;break}return e.next=12,this.props.thread.fetchThreadDetail(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.threadId);case 12:this.props.thread.updateListStore();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onRewardClick",value:function(){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.setState({showRewardPopup:!0})}},{key:"onRewardSubmit",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c,l,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(isNaN(Number(t))||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId||null===(a=this.props.thread)||void 0===a||null===(s=a.threadData)||void 0===s||!s.userId){e.next=9;break}return this.setState({showRewardPopup:!1}),l={amount:Number(t),threadId:this.props.thread.threadData.threadId,payeeId:this.props.thread.threadData.userId,title:(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.title)||"\u4e3b\u9898\u6253\u8d4f"},e.next=5,this.props.thread.rewardPay(l,this.props.user);case 5:u=e.sent,d=u.success,p=u.msg,d||F.a.error({content:p});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTagClick",value:function(){var e,t,n=null===(e=this.props.thread)||void 0===e||null===(t=e.threadData)||void 0===t?void 0:t.categoryId;(n||"number"===typeof n)&&this.props.index.refreshHomeData({categoryIds:[n]}),this.props.vlist.resetPosition(),this.props.router.push("/")}},{key:"replyAvatarClick",value:function(e,t,n){if(2===n){var i=e.userId;if(!i)return;this.props.router.push("/user/".concat(i))}if(3===n){var a=e.commentUserId;if(!a)return;this.props.router.push("/user/".concat(a))}}},{key:"onUserClick",value:function(e){var t,n,i=(this.props.thread||{}).threadData;(null===i||void 0===i||null===(t=i.user)||void 0===t?void 0:t.userId)&&this.props.router.push("/user/".concat(null===i||void 0===i||null===(n=i.user)||void 0===n?void 0:n.userId))}},{key:"onLoadMoreClick",value:function(){this.props.commentPosition.page=this.props.commentPosition.page+1,this.loadCommentPositionList()}},{key:"loadCommentPositionList",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.props.commentPosition.isCommentReady,!this.state.isCommentLoading&&s){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,page:(null===(i=this.props)||void 0===i||null===(a=i.commentPosition)||void 0===a?void 0:a.page)||1,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.commentPosition.loadCommentList(c);case 8:if(l=e.sent,u=l.success,d=l.msg,this.setState({isCommentLoading:!1}),!u){e.next=14;break}return e.abrupt("return",!0);case 14:F.a.error({content:d});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n,a,r,s,o,c,l,u,d,p,h,v,m,f,j,k=this,x=this.props.thread,C=x.isReady,y=x.isCommentReady,O=x.isNoMore,w=x.totalCount,g=x.isCommentListError,P={moreClick:this.onMoreClick},S={canEdit:null===x||void 0===x||null===(e=x.threadData)||void 0===e||null===(t=e.ability)||void 0===t?void 0:t.canEdit,canDelete:null===x||void 0===x||null===(n=x.threadData)||void 0===n||null===(a=n.ability)||void 0===a?void 0:a.canDelete,canEssence:null===x||void 0===x||null===(r=x.threadData)||void 0===r||null===(s=r.ability)||void 0===s?void 0:s.canEssence,canStick:null===x||void 0===x||null===(o=x.threadData)||void 0===o||null===(c=o.ability)||void 0===c?void 0:c.canStick,canShare:this.props.user.isLogin(),canWxShare:this.props.user.isLogin()&&Object(le.a)(),canCollect:this.props.user.isLogin(),isAdmini:null===(l=this.props)||void 0===l||null===(u=l.user)||void 0===u?void 0:u.isAdmini},T={isEssence:null===x||void 0===x||null===(d=x.threadData)||void 0===d||null===(p=d.displayTag)||void 0===p?void 0:p.isEssence,isStick:null===x||void 0===x||null===(h=x.threadData)||void 0===h?void 0:h.isStick,isCollect:null===x||void 0===x?void 0:x.isFavorite},A=1===((null===x||void 0===x||null===(v=x.threadData)||void 0===v?void 0:v.isApproved)||0),V=this.props.commentPosition,F=V.isShowCommentList,W=V.isNoMore;return Object(i.jsxs)("div",{className:N.a.container,children:[Object(i.jsxs)("div",{className:N.a.header,children:[Object(i.jsx)(B.a,{}),C&&!A&&Object(i.jsxs)("div",{className:N.a.examine,children:[Object(i.jsx)(E.a,{className:N.a.tipsIcon,name:"TipsOutlined"}),Object(i.jsx)("span",{className:N.a.tipsText,children:"\u5185\u5bb9\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\u624d\u80fd\u6b63\u5e38\u663e\u793a\uff01"})]})]}),Object(i.jsxs)("div",{className:N.a.body,ref:this.threadBodyRef,onScrollCapture:Object(K.a)((function(){return k.handleOnScroll()}),1e3),children:[Object(i.jsx)(_,{showContent:this.state.showContent,setTop:this.state.setTop}),C?Object(i.jsx)(Ne,{store:x,setContentImgReady:this.setContentImgReady,fun:P,onLikeClick:function(){return k.onLikeClick()},onOperClick:function(e){return k.onOperClick(e)},onCollectionClick:function(){return k.onCollectionClick()},onReportClick:function(){return k.onReportClick()},onRewardClick:function(){return k.onRewardClick()},onTagClick:function(){return k.onTagClick()},onPayClick:function(){return k.onPayClick()},onUserClick:function(e){return k.onUserClick(e)}}):Object(i.jsx)(L.a,{type:"init"}),C&&A&&Object(i.jsx)("div",{className:"".concat(N.a.bottom),ref:this.commentDataRef,children:y?Object(i.jsxs)(b.Fragment,{children:[y&&F&&Object(i.jsxs)(b.Fragment,{children:[Object(i.jsx)(Ee,{isPositionComment:!0,router:this.props.router,sort:function(e){return k.onSortChange(e)},replyAvatarClick:function(e,t,n){return k.replyAvatarClick(e,t,n)}}),!W&&Object(i.jsxs)("div",{className:N.a.showMore,onClick:function(){return k.onLoadMoreClick()},children:[Object(i.jsx)("div",{className:N.a.hidePercent,children:"\u5c55\u5f00\u66f4\u591a\u8bc4\u8bba"}),Object(i.jsx)(E.a,{className:N.a.icon,name:"RightOutlined",size:12})]})]}),Object(i.jsx)(Ee,{canPublish:this.props.canPublish,positionRef:this.positionRef,showHeader:!F,router:this.props.router,sort:function(e){return k.onSortChange(e)},onEditClick:function(e){return k.onEditClick(e)},replyAvatarClick:function(e,t,n){return k.replyAvatarClick(e,t,n)}}),Object(i.jsx)(Me.a,{noMoreType:"line",isError:g,noMore:O})]}):Object(i.jsx)(L.a,{isError:g,type:"init"})}),Object(i.jsx)(Ve.a,{marginTop:0})]}),C&&A&&Object(i.jsx)("div",{className:N.a.footerContainer,children:Object(i.jsxs)("div",{className:N.a.footer,children:[Object(i.jsx)("div",{className:R.a.inputClick,onClick:function(){return k.onInputClick()},children:Object(i.jsx)(M.a,{className:R.a.input,placeholder:"\u5199\u8bc4\u8bba",disabled:!0,prefixIcon:"EditOutlined"})}),Object(i.jsxs)("div",{className:R.a.operate,children:[Object(i.jsxs)("div",{className:R.a.icon,onClick:function(){return k.onMessageClick()},children:[this.state.stateFlag?w>0?Object(i.jsx)("div",{className:I()(R.a.badge,w<10&&R.a.isCricle),children:w>99?"99+":"".concat(w||"0")}):"":Object(i.jsx)("div",{className:R.a.content,children:"\u6b63\u6587"}),Object(i.jsx)(E.a,{size:"20",name:"MessageOutlined"})]}),Object(i.jsx)(E.a,{className:I()(R.a.icon,D()({},R.a.isliked,null===(m=this.props.thread)||void 0===m||null===(f=m.threadData)||void 0===f?void 0:f.isLike)),onClick:Object(X.a)((function(){return k.onLikeClick()}),500),size:"20",name:"LikeOutlined"}),Object(i.jsx)(E.a,{className:I()(R.a.icon,D()({},R.a.isliked,null===(j=this.props.thread)||void 0===j?void 0:j.isFavorite)),onClick:Object(X.a)((function(){return k.onCollectionClick()}),500),size:"20",name:"CollectOutlinedBig"}),Object(i.jsx)(E.a,{onClick:Object(J.a)((function(){return k.handleClick()}),1e3),className:R.a.icon,size:"20",name:"ShareAltOutlined"})]})]})}),Object(i.jsx)(Fe.a,{show:this.state.show,onClose:this.onShareClose,handleH5Share:this.handleH5Share,handleWxShare:this.handleWxShare,createCard:this.createCard}),C&&Object(i.jsxs)(b.Fragment,{children:[Object(i.jsx)(H.a,{visible:this.state.showCommentInput,onClose:function(){return k.onClose()},initValue:this.state.inputValue,onSubmit:function(e,t){return k.onPublishClick(e,t)},site:this.props.site}),Object(i.jsx)(G.a,{permissions:S,statuses:T,visible:this.state.showMorePopup,onClose:function(){return k.setState({showMorePopup:!1})},onSubmit:function(){return k.setState({showMorePopup:!1})},onOperClick:function(e){return k.onOperClick(e)}}),Object(i.jsx)(q.a,{visible:this.state.showDeletePopup,onClose:function(){return k.setState({showDeletePopup:!1})},onBtnClick:function(e){return k.onBtnClick(e)},type:"thread"}),Object(i.jsx)(z.a,{reportContent:this.reportContent,inputText:this.inputText,visible:this.state.showReportPopup,onCancel:function(){return k.setState({showReportPopup:!1})},onOkClick:function(e){return k.onReportOk(e)}}),Object(i.jsx)(oe,{visible:this.state.showRewardPopup,onCancel:function(){return k.setState({showRewardPopup:!1})},onOkClick:function(e){return k.onRewardSubmit(e)}}),this.state.loadWeiXin&&Object(i.jsx)(ce.a,{visible:this.state.isShowWeiXinShare,onClose:function(){return k.setState({isShowWeiXinShare:!1})},type:"thread"})]})]})}}]),n}(k.a.Component))||Te)||Te)||Te)||Te)||Te)||Te)||Te)||Te)||Te,Ue=Object(Ae.a)(Object(x.withRouter)(ze)),_e=n("JMpY"),qe=n("iUiS"),Ge=n("E2V6"),He=function(e){var t=e.visible,n=e.onOkClick,a=Object(b.useState)(""),s=a[0],c=a[1];Object(b.useEffect)((function(){c("")}),[t]);var l=function(){"function"===typeof(null===e||void 0===e?void 0:e.onCancel)&&e.onCancel()},u=function(){var e=o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(""===s||Number(s)<=0||Number(s)>1e6)){e.next=4;break}return(""===s||Number(s)<=0)&&F.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u4e3a0"}),Number(s)>1e6&&F.a.error({content:"\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7100\u4e07"}),e.abrupt("return");case 4:if("function"!==typeof n){e.next=16;break}return e.prev=6,e.next=9,n(s);case 9:e.sent&&c(""),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(ee.a,{position:"center",visible:t,onClose:l,children:Object(i.jsxs)("div",{className:Ge.a.container,children:[Object(i.jsxs)("div",{className:Ge.a.header,children:[Object(i.jsx)("div",{className:Ge.a.headerLeft,children:"\u652f\u4ed8\u4f5c\u8005\u7ee7\u7eed\u521b\u4f5c"}),Object(i.jsx)(E.a,{className:Ge.a.headerIcon,size:14,name:"CloseOutlined",onClick:l})]}),Object(i.jsxs)("div",{className:Ge.a.rewardInput,children:[Object(i.jsx)("span",{className:Ge.a.prepend,children:"\u652f\u4ed8\u91d1\u989d"}),Object(i.jsx)(M.a,{mode:"number",placeholder:"\u91d1\u989d",className:Ge.a.input,value:s,onChange:function(e){return function(e){var t=e.match(/([1-9]\d{0,6}|0)(\.\d{0,2})?/);c(t?t[0]:"")}(e.target.value)}}),Object(i.jsx)("span",{className:Ge.a.append,children:"\u5143"})]}),Object(i.jsx)("div",{className:Ge.a.rewardList,children:[1,2,5,10,20,50,88,128].map((function(e){return Object(i.jsxs)("div",{onClick:function(){return function(e){c(e)}(e)},className:I()(Ge.a.reward,Number(s)===e&&Ge.a.actived),children:["\uffe5",e]},e)}))}),Object(i.jsxs)("div",{className:Ge.a.button,children:[Object(i.jsx)(ne.a,{onClick:l,className:Ge.a.cancel,type:"default",children:"\u53d6\u6d88"}),Object(i.jsx)(ne.a,{onClick:u,className:Ge.a.ok,type:"primary",children:"\u786e\u5b9a"})]})]})})},Ke=n("INMq"),Xe=n("KimE"),Je=n("2w7u"),Qe=n("cjmN"),Ye=function(e){var t=e.showContent,n=e.setTop;return Object(i.jsxs)("div",{className:"".concat(Qe.a.setTop," ").concat(n?Qe.a.inTop:Qe.a.outTop),children:[Object(i.jsx)("span",{className:Qe.a.setTopIcon,children:Object(i.jsx)(E.a,{className:Qe.a.icon,name:"CheckOutlined"})}),t?"\u7f6e\u9876\u6210\u529f":"\u5df2\u53d6\u6d88\u7f6e\u9876"]})},Ze=n("DT/J"),$e=function(e){var t=e.isShow;return Object(i.jsx)("div",{className:"".concat(Ze.a.examine," ").concat(Ze.a.setTop," ").concat(t?Ze.a.inTop:Ze.a.outTop),children:Object(i.jsxs)("div",{className:Ze.a.innerTip,children:[Object(i.jsx)(E.a,{className:Ze.a.tipsIcon,name:"TipsOutlined"}),Object(i.jsx)("span",{className:Ze.a.tipsText,children:"\u5185\u5bb9\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\u624d\u80fd\u6b63\u5e38\u663e\u793a\uff01"})]})})},et=n("Wpw2"),tt=n("7BN5"),nt=n("nfQ1"),it=n.n(nt),at=n("wdPI"),rt=n("kBz5"),st=Object(C.c)("site","user")(Object(C.d)((function(e){var t,n,a,s,c,l,u,d,p,h,v,m,f,j,b,k,x,C,y,O,D,w,g,N,R,P,S,L,T,A,M,V,F,B,W,z,U,_,q,G,H,K,J,Q,Y,Z,$,ee,te,ie,re,se,oe,ce,le,xe,Oe,De,we,Ne,Re,Pe,Ie,Se,Le,Te,Ee,Ae,Me=e.store,Ve=e.site,Fe=(null===Me||void 0===Me||null===(t=Me.threadData)||void 0===t?void 0:t.content)||{},Be=Fe.text,We=Fe.indexes,ze=null===Me||void 0===Me?void 0:Me.threadData,Ue=ze.parentCategoryName,_e=ze.categoryName,qe=Me.hasRedPacket,Ge={postId:null===Me||void 0===Me||null===(n=Me.threadData)||void 0===n?void 0:n.postId,threadId:null===Me||void 0===Me||null===(a=Me.threadData)||void 0===a?void 0:a.threadId,platform:"pc",payType:null===Me||void 0===Me||null===(s=Me.threadData)||void 0===s?void 0:s.payType},He=1===((null===Me||void 0===Me||null===(c=Me.threadData)||void 0===c?void 0:c.isApproved)||0),Ke=0===(null===Me||void 0===Me||null===(l=Me.threadData)||void 0===l?void 0:l.payType),Xe=(null===Me||void 0===Me||null===(u=Me.threadData)||void 0===u||null===(d=u.displayTag)||void 0===d?void 0:d.isEssence)||!1,Je=null===Me||void 0===Me||null===(p=Me.threadData)||void 0===p?void 0:p.isStick,Qe=null===Me||void 0===Me||null===(h=Me.threadData)||void 0===h||null===(v=h.ability)||void 0===v?void 0:v.canEdit,Ye=null===Me||void 0===Me||null===(m=Me.threadData)||void 0===m||null===(f=m.ability)||void 0===f?void 0:f.canDelete,Ze=null===Me||void 0===Me||null===(j=Me.threadData)||void 0===j||null===(b=j.ability)||void 0===b?void 0:b.canEssence,$e=null===Me||void 0===Me||null===(k=Me.threadData)||void 0===k||null===(x=k.ability)||void 0===x?void 0:x.canStick,et=2===(null===Me||void 0===Me||null===(C=Me.threadData)||void 0===C?void 0:C.payType)&&!1===(null===Me||void 0===Me||null===(y=Me.threadData)||void 0===y?void 0:y.paid),tt=(null===Me||void 0===Me||null===(O=Me.threadData)||void 0===O?void 0:O.attachmentPrice)||0,nt=!pt&&et&&!lt&&!ct,st=1===(null===Me||void 0===Me||null===(D=Me.threadData)||void 0===D?void 0:D.payType),ot=(null===Me||void 0===Me||null===(w=Me.threadData)||void 0===w?void 0:w.price)||0,ct=!0===(null===Me||void 0===Me||null===(g=Me.threadData)||void 0===g?void 0:g.paid),lt=(null===(N=e.user)||void 0===N||null===(R=N.userInfo)||void 0===R?void 0:R.id)&&(null===(P=e.user)||void 0===P||null===(S=P.userInfo)||void 0===S?void 0:S.id)===(null===Me||void 0===Me||null===(L=Me.threadData)||void 0===L?void 0:L.userId),ut=null===Me||void 0===Me||null===(T=Me.threadData)||void 0===T||null===(A=T.displayTag)||void 0===A?void 0:A.isRedPack,dt=null===Me||void 0===Me||null===(M=Me.threadData)||void 0===M||null===(V=M.displayTag)||void 0===V?void 0:V.isReward,pt=(Ke&&(null===Me||void 0===Me||null===(F=Me.threadData)||void 0===F||F.ability.canBeReward),null===Me||void 0===Me||null===(B=Me.threadData)||void 0===B||B.isReward,null===Me||void 0===Me||null===(W=Me.threadData)||void 0===W?void 0:W.ability.canFreeViewPost),ht=Object(ue.a)(We);1===(null===(z=ht.RED_PACKET)||void 0===z?void 0:z.condition)&&Me.getRedPacketInfo(ht.RED_PACKET.threadId);var vt=function(){var t=o()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"function"===typeof e.onPayClick&&e.onPayClick();case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),mt=function(e){e&&window.open(e)},ft=function(t){"function"===typeof e.onOperClick&&e.onOperClick(t)},jt=(null===Me||void 0===Me||null===(U=Me.threadData)||void 0===U?void 0:U.ability)||{},bt=jt.canDownloadAttachment,kt=jt.canViewAttachment,xt=jt.canViewVideo;return Object(i.jsxs)("div",{className:"".concat(at.a.container),children:[Object(i.jsxs)("div",{className:at.a.header,children:[Object(i.jsx)("div",{className:at.a.userInfo,children:Object(i.jsx)(ke.a,{name:(null===Me||void 0===Me||null===(_=Me.threadData)||void 0===_||null===(q=_.user)||void 0===q?void 0:q.nickname)||"",avatar:(null===Me||void 0===Me||null===(G=Me.threadData)||void 0===G||null===(H=G.user)||void 0===H?void 0:H.avatar)||"",groupName:(null===Me||void 0===Me||null===(K=Me.threadData)||void 0===K||null===(J=K.group)||void 0===J?void 0:J.groupName)||"",location:(null===Me||void 0===Me||null===(Q=Me.threadData)||void 0===Q?void 0:Q.position.location)||"",view:"".concat(null===Me||void 0===Me||null===(Y=Me.threadData)||void 0===Y?void 0:Y.viewCount)||"",time:"".concat(null===Me||void 0===Me||null===(Z=Me.threadData)||void 0===Z?void 0:Z.diffTime)||"",userId:null===Me||void 0===Me||null===($=Me.threadData)||void 0===$||null===(ee=$.user)||void 0===ee?void 0:ee.userId,isEssence:Xe,isPay:!Ke,isReward:dt,isRed:ut,hideInfoPopip:!0,platform:"pc",onClick:function(t){t&&t.stopPropagation(),"function"===typeof e.onUserClick&&e.onUserClick()}})}),(null===e||void 0===e||null===(te=e.user)||void 0===te?void 0:te.isLogin())&&Object(i.jsxs)("div",{className:at.a.more,children:[(Xe||!Ke||dt||ut)&&Object(i.jsx)(ae.a,{mode:"vertical",className:at.a.moreDivider}),He&&(Qe||$e||Ze||Ye)&&Object(i.jsx)("div",{className:at.a.iconText,children:Object(i.jsxs)(it.a,{menu:Object(i.jsxs)(it.a.Menu,{children:[Qe&&Object(i.jsx)(it.a.Item,{id:"edit",children:"\u7f16\u8f91"}),$e&&Object(i.jsx)(it.a.Item,{id:"stick",children:Je?"\u53d6\u6d88\u7f6e\u9876":"\u7f6e\u9876"}),Ze&&Object(i.jsxs)(it.a.Item,{id:"essence",children:[" ",Xe?"\u53d6\u6d88\u7cbe\u534e":"\u7cbe\u534e"]}),Ye&&Object(i.jsx)(it.a.Item,{id:"delete",children:"\u5220\u9664"})]}),placement:"center",hideOnClick:!0,arrow:!1,trigger:"hover",onChange:function(e){return ft(e)},children:[Object(i.jsx)(E.a,{className:at.a.icon,name:"SettingOutlined"}),Object(i.jsx)("span",{className:at.a.text,children:"\u7ba1\u7406"})]})}),!(null!==e&&void 0!==e&&null!==(ie=e.user)&&void 0!==ie&&ie.isAdmini)&&Object(i.jsxs)("div",{className:I()(at.a.iconText,(null===e||void 0===e||null===(re=e.user)||void 0===re?void 0:re.isAdmini)&&at.a.disabled),onClick:function(){return ft("report")},children:[Object(i.jsx)(E.a,{className:at.a.icon,name:"WarnOutlinedThick"}),Object(i.jsx)("span",{className:at.a.text,children:"\u4e3e\u62a5"})]})]})]}),Object(i.jsx)(ae.a,{className:at.a.divider}),Object(i.jsxs)("div",{className:at.a.body,children:[(null===Me||void 0===Me||null===(se=Me.threadData)||void 0===se?void 0:se.title)&&Object(i.jsx)("div",{className:at.a.title,children:null===Me||void 0===Me||null===(oe=Me.threadData)||void 0===oe?void 0:oe.title}),Be&&Object(i.jsx)(he.a,{needShowMore:!1,content:Be||"",usePointer:!1}),ht.VIDEO&&Object(i.jsx)(me.a,{url:ht.VIDEO.mediaUrl,coverUrl:ht.VIDEO.coverUrl,v_width:ht.VIDEO.width||null,v_height:ht.VIDEO.height||null,status:ht.VIDEO.status,canViewVideo:xt}),ht.IFRAME&&Object(i.jsx)(Ce.a,{content:ht.IFRAME.content}),ht.IMAGE&&Object(i.jsx)(de.a,{flat:!0,platform:"pc",isPay:nt,onPay:vt,imgData:ht.IMAGE}),(ht.RED_PACKET||ht.REWARD)&&Object(i.jsxs)("div",{className:at.a.reward,style:{width:"100%"},children:[ht.REWARD&&Object(i.jsxs)("div",{className:at.a.rewardBody,style:{width:"100%"},children:[Object(i.jsx)(ye.a,{type:1,money:ht.REWARD.money,remainMoney:ht.REWARD.remainMoney}),Object(i.jsxs)("div",{className:at.a.rewardMoney,children:["\u672c\u5e16\u5411\u6240\u6709\u4eba\u60ac\u8d4f",Object(i.jsx)("span",{className:at.a.rewardNumber,children:ht.REWARD.money||0}),"\u5143"]}),Object(i.jsxs)("div",{className:at.a.rewardTime,children:[ht.REWARD.expiredAt,"\u622a\u6b62\u60ac\u8d4f"]})]}),ht.RED_PACKET&&Object(i.jsxs)("div",{style:{width:"100%"},children:[Object(i.jsx)(ye.a,{number:ht.RED_PACKET.number,remainNumber:ht.RED_PACKET.remainNumber,condition:ht.RED_PACKET.condition}),!!ht.RED_PACKET.condition&&Object(i.jsxs)("div",{className:at.a.redPacketLikeNum,children:["\u8bc4\u8bba\u96c6",ht.RED_PACKET.likenum,"\u8d5e\u9886\u7ea2\u5305"]})]})]}),ht.GOODS&&Object(i.jsxs)("div",{className:at.a.goods,children:[Object(i.jsx)(ve.a,{image:null===ht||void 0===ht||null===(ce=ht.GOODS)||void 0===ce?void 0:ce.imagePath,amount:null===ht||void 0===ht||null===(le=ht.GOODS)||void 0===le?void 0:le.price,title:null===ht||void 0===ht||null===(xe=ht.GOODS)||void 0===xe?void 0:xe.title,onClick:function(){return mt(ht.GOODS.detailContent)}}),Object(i.jsx)(ne.a,{className:at.a.buyBtn,type:"danger",onClick:function(){return mt(ht.GOODS.detailContent)},children:Object(i.jsxs)("div",{className:at.a.buyContent,children:[Object(i.jsx)(E.a,{className:at.a.buyIcon,name:"ShoppingCartOutlined",size:20}),Object(i.jsx)("span",{className:at.a.buyText,children:"\u8d2d\u4e70\u5546\u54c1"})]})})]}),ht.VOICE&&Object(i.jsx)(pe.a,{url:ht.VOICE.mediaUrl}),ht.VOTE&&Object(i.jsx)(be.a,{attachments:ht.VOTE,threadId:null===Me||void 0===Me||null===(Oe=Me.threadData)||void 0===Oe?void 0:Oe.threadId,canViewAttachment:kt,canDownloadAttachment:bt}),ht.VOTE_THREAD&&Object(i.jsx)(fe.a,{voteData:ht.VOTE_THREAD,threadId:null===Me||void 0===Me||null===(De=Me.threadData)||void 0===De?void 0:De.threadId,page:"detail"}),nt&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:vt,children:Object(i.jsx)(ne.a,{className:at.a.payButton,type:"primary",size:"large",children:Object(i.jsxs)("div",{className:at.a.pay,children:[Object(i.jsx)(E.a,{className:at.a.payIcon,name:"GoldCoinOutlined",size:18}),"\u652f\u4ed8",tt,"\u5143\u67e5\u770b\u9644\u4ef6"]})})}),ge.a.injection("plugin_detail","thread_extension_display_hook").map((function(e){var t=e.render,n=e.pluginInfo;return Object(i.jsx)("div",{children:t({site:Ve,renderData:ht.plugin})},n.name)})),(Ue||_e)&&Object(i.jsx)("div",{className:at.a.tag,onClick:function(){"function"===typeof e.onTagClick&&e.onTagClick()},children:Ue?"".concat(Ue,"/").concat(_e):_e}),!pt&&st&&!lt&&!ct&&Object(i.jsx)("div",{style:{textAlign:"center"},onClick:vt,children:Object(i.jsx)(ne.a,{className:at.a.payButton,type:"primary",size:"large",children:Object(i.jsxs)("div",{className:at.a.pay,children:[Object(i.jsx)(E.a,{className:at.a.payIcon,name:"GoldCoinOutlined",size:18}),"\u652f\u4ed8",ot,"\u5143\u67e5\u770b\u5269\u4f59\u5185\u5bb9"]})})}),Object(i.jsx)(ne.a,{onClick:function(){"function"===typeof e.onRewardClick&&e.onRewardClick()},className:at.a.rewardButton,type:"primary",size:"large",children:Object(i.jsxs)("div",{className:at.a.buttonIconText,children:[Object(i.jsx)(E.a,{className:at.a.buttonIcon,name:"HeartOutlined",size:19}),Object(i.jsx)("span",{className:at.a.buttonText,children:"\u6253\u8d4f"})]})})]}),Object(i.jsxs)("div",{className:at.a.footer,children:[Object(i.jsxs)("div",{className:at.a.thumbs,children:[Object(i.jsx)("div",{className:at.a.likeReward,children:Object(i.jsx)(je.a,{tipData:Ge,imgs:(null===Me||void 0===Me||null===(we=Me.threadData)||void 0===we||null===(Ne=we.likeReward)||void 0===Ne?void 0:Ne.users)||[],showCount:10,platform:"pc"})}),Object(i.jsx)("span",{children:(null===Me||void 0===Me||null===(Re=Me.threadData)||void 0===Re||null===(Pe=Re.likeReward)||void 0===Pe?void 0:Pe.likePayCount)||""})]}),(null===Me||void 0===Me||null===(Ie=Me.threadData)||void 0===Ie||null===(Se=Ie.likeReward)||void 0===Se?void 0:Se.shareCount)>0&&Object(i.jsxs)("span",{className:at.a.share,children:[null===Me||void 0===Me||null===(Le=Me.threadData)||void 0===Le||null===(Te=Le.likeReward)||void 0===Te?void 0:Te.shareCount,"\u6b21\u5206\u4eab"]})]}),Object(i.jsx)(ae.a,{className:at.a.divider}),He&&Object(i.jsxs)("div",{className:at.a.bottomOperate,children:[Object(i.jsxs)("div",{className:I()(at.a.item,(null===Me||void 0===Me||null===(Ee=Me.threadData)||void 0===Ee?void 0:Ee.isLike)&&at.a.active),onClick:Object(X.a)((function(){"function"===typeof e.onLikeClick&&e.onLikeClick()}),500),children:[Object(i.jsx)(E.a,{name:"LikeOutlined"}),Object(i.jsx)("span",{children:"\u8d5e"})]}),Object(i.jsxs)("div",{className:I()(at.a.item,(null===Me||void 0===Me||null===(Ae=Me.threadData)||void 0===Ae?void 0:Ae.isFavorite)&&at.a.active),onClick:Object(X.a)((function(){"function"===typeof e.onCollectionClick&&e.onCollectionClick()}),500),children:[Object(i.jsx)(E.a,{name:"CollectOutlined"}),Object(i.jsx)("span",{children:"\u6536\u85cf"})]}),Object(i.jsxs)("div",{className:I()(at.a.item),onClick:Object(X.a)((function(){"function"===typeof e.onShareClick&&e.onShareClick()}),500),children:[Object(i.jsx)(E.a,{name:"ShareAltOutlined"}),Object(i.jsx)("span",{children:"\u5206\u4eab"})]})]}),qe>0&&Object(i.jsx)(rt.a,{onClose:function(){return Me.setRedPacket(0)},money:qe})]})}))),ot=(n("T63A"),n("tkto"),n("J4zp")),ct=n.n(ot),lt=n("TciF"),ut=n("/c/8"),dt=n("PuBq");function pt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var a=j()(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return m()(this,n)}}var ht={101:"IMAGE",102:"VOICE",103:"VIDEO",104:"GOODS",105:"QA",106:"RED_PACKET",107:"REWARD",108:"VOTE",109:"QUEUE",110:"FILE",111:"QA_IMAGE"},vt=Object(C.c)("thread")(We=Object(C.c)("comment")(We=Object(C.c)("commentPosition")(We=Object(C.c)("user")(We=Object(C.d)(We=function(e){h()(n,e);var t=pt(n);function n(e){var i;return l()(this,n),(i=t.call(this,e)).onSortClick=function(){i.setState({commentSort:!i.state.commentSort}),"function"===typeof i.props.sort&&i.props.sort(!i.state.commentSort)},i.state={showAboptPopup:!1,showCommentInput:!1,commentSort:!0,showDeletePopup:!1,showReplyDeletePopup:!1,placeholder:"\u5199\u4e0b\u6211\u7684\u8bc4\u8bba...",commentId:null},i.comment10Ref=k.a.createRef(),i.commentData=null,i.replyData=null,i}return d()(n,[{key:"componentDidMount",value:function(){var e,t;null!==(e=this.props)&&void 0!==e&&null!==(t=e.thread)&&void 0!==t&&t.isPositionToComment&&this.comment10Ref.current&&this.comment10Ref.current.scrollIntoView()}},{key:"likeClick",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:if(t.id){e.next=6;break}return e.abrupt("return");case 6:return n={id:t.id,isLiked:!t.isLiked},e.next=9,this.props.comment.updateLiked(n,this.props.thread);case 9:i=e.sent,a=i.success,s=i.msg,a&&(this.props.isPositionComment?(this.props.commentPosition.setCommentListDetailField(t.id,"isLiked",n.isLiked),o=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setCommentListDetailField(t.id,"likeCount",o)):(this.props.thread.setCommentListDetailField(t.id,"isLiked",n.isLiked),c=n.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setCommentListDetailField(t.id,"likeCount",c))),a||F.a.error({content:s});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replyLikeClick",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:if(t.id){e.next=6;break}return e.abrupt("return");case 6:return i={id:t.id,isLiked:!t.isLiked},e.next=9,this.props.comment.updateLiked(i);case 9:a=e.sent,s=a.success,o=a.msg,s&&(this.props.isPositionComment?(this.props.commentPosition.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),c=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.commentPosition.setReplyListDetailField(n.id,t.id,"likeCount",c)):(this.props.thread.setReplyListDetailField(n.id,t.id,"isLiked",i.isLiked),l=i.isLiked?t.likeCount+1:t.likeCount-1,this.props.thread.setReplyListDetailField(n.id,t.id,"likeCount",l))),s||F.a.error({content:o});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteClick",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:this.commentData=t,this.setState({showDeletePopup:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteComment",value:function(){var e=o()(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:if(this.commentData.id){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this.props.comment.delete(this.commentData.id,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 8:if(t=e.sent,n=t.success,i=t.msg,this.setState({showDeletePopup:!1}),!n){e.next=15;break}return F.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 15:F.a.error({content:i});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyDeleteClick",value:function(){var e=o()(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.commentData=n,this.replyData=t,this.setState({showReplyDeletePopup:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"replyDeleteComment",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.replyData.id){e.next=2;break}return e.abrupt("return");case 2:return t={},this.replyData&&this.commentData&&(t.replyData=this.replyData,t.commentData=this.commentData),e.next=6,this.props.comment.deleteReplyComment(t,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 6:if(n=e.sent,i=n.success,a=n.msg,this.setState({showReplyDeletePopup:!1}),!i){e.next=13;break}return F.a.success({content:"\u5220\u9664\u6210\u529f"}),e.abrupt("return");case 13:F.a.error({content:a});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"replyClick",value:function(e){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.props.canPublish("reply")&&(this.commentData=e,this.replyData=null,this.setState({showCommentInput:!0,commentId:e.id}))}},{key:"replyReplyClick",value:function(e,t){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.props.canPublish("reply")&&(this.commentData=null,this.replyData=e,this.replyData.commentId=t.id,this.setState({showCommentInput:!0,commentId:null}))}},{key:"createReply",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.length>0&&void 0!==p[0]?p[0]:"",a=p.length>1&&void 0!==p[1]?p[1]:[],i.replace(/\s/g,"")||0!==a.length){e.next=6;break}return F.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 6:if(s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id){e.next=9;break}return e.abrupt("return");case 9:return o={id:s,content:i},this.replyData&&(o.replyId=this.replyData.id,o.isComment=!0,o.commentId=this.replyData.commentId,o.commentPostId=this.replyData.id),this.commentData&&(o.replyId=this.commentData.id,o.isComment=!0,o.commentId=this.commentData.id),null!==a&&void 0!==a&&a.length&&(o.attachments=a.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=15,this.props.comment.createReply(o,this.props.isPositionComment?this.props.commentPosition:this.props.thread);case 15:if(c=e.sent,l=c.success,u=c.msg,d=c.isApproved,!l){e.next=23;break}return this.setState({showCommentInput:!1,inputValue:"",commentId:null}),d?F.a.success({content:u}):F.a.warning({content:u}),e.abrupt("return",!0);case 23:F.a.error({content:u});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"editClick",value:function(e){"function"===typeof this.props.onEditClick&&this.props.onEditClick(e)}},{key:"onCommentClick",value:function(e){var t,n,i,a;e.id&&null!==(t=this.props.thread)&&void 0!==t&&null!==(n=t.threadData)&&void 0!==n&&n.id&&this.props.router.push("/thread/comment/".concat(e.id,"?threadId=").concat(null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id))}},{key:"onAboptClick",value:function(e){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.commentData=e,this.setState({showAboptPopup:!0})}},{key:"onAboptOk",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=15;break}return a={postId:this.commentData.id,rewards:t,threadId:null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.threadId},e.next=4,this.props.thread.reward(a);case 4:if(s=e.sent,o=s.success,c=s.msg,!o){e.next=12;break}return this.setState({showAboptPopup:!1}),this.props.thread.fetchThreadDetail(a.threadId),F.a.success({content:"\u60ac\u8d4f".concat(t,"\u5143")}),e.abrupt("return",!0);case 12:F.a.error({content:c}),e.next=16;break;case 15:F.a.info({content:"\u60ac\u8d4f\u91d1\u989d\u4e0d\u80fd\u4e3a0"});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onAboptCancel",value:function(){this.commentData=null,this.setState({showAboptPopup:!1})}},{key:"onUserClick",value:function(e){e&&g.a.push({url:"/user/".concat(e)})}},{key:"reportClick",value:function(e){"function"===typeof this.props.onReportClick&&this.props.onReportClick(e)}},{key:"replyAvatarClick",value:function(e,t,n){if(2===n){var i=e.userId;if(!i)return;this.props.router.push("/user/".concat(i))}if(3===n){var a=e.commentUserId;if(!a)return;this.props.router.push("/user/".concat(a))}}},{key:"onFocus",value:function(e){return this.props.user.isLogin()?!!this.props.canPublish("reply")||void 0:(e&&e.stopPropagation(),F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"}))}},{key:"render",value:function(){var e,t,n,a,r,s,o,c,l,u,d,p,h,v,m=this,f=this.props.thread,j=f.totalCount,b=f.commentList,k=this.props.commentPosition,x=k.commentList,C=k.postId;this.props.isPositionComment&&(b=x||[]);var y=(null===(e=this.props.user)||void 0===e||null===(t=e.userInfo)||void 0===t?void 0:t.id)&&(null===(n=this.props.user)||void 0===n||null===(a=n.userInfo)||void 0===a?void 0:a.id)===(null===(r=this.props.thread)||void 0===r||null===(s=r.threadData)||void 0===s?void 0:s.userId),O=null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c||null===(l=c.displayTag)||void 0===l?void 0:l.isReward,D=((null===(u=this.props.thread)||void 0===u?void 0:u.threadData)||"").isAnonymous,w=((null===(d=this.props.thread)||void 0===d||null===(p=d.threadData)||void 0===p?void 0:p.content)||{}).indexes,g={};return w&&Object.keys(w)&&Object.entries(w).forEach((function(e){var t=ct()(e,2)[1];if(t){var n=t.tomId,i=t.body;g[ht[n]]=i}})),Object(i.jsxs)("div",{className:I()(lt.a.container,!j&&lt.a.isEmpty),children:[this.props.showHeader&&Object(i.jsxs)("div",{className:lt.a.header,children:[j?Object(i.jsxs)("div",{className:lt.a.number,children:[j,"\u6761\u8bc4\u8bba"]}):Object(i.jsx)("div",{className:lt.a.number,children:"\u6682\u65e0\u8bc4\u8bba"}),Object(i.jsxs)("div",{className:lt.a.sort,onClick:function(){return m.onSortClick()},children:[Object(i.jsx)(E.a,{className:lt.a.sortIcon,name:"SortOutlined",size:14}),Object(i.jsx)("span",{className:lt.a.sortText,children:this.state.commentSort?"\u8bc4\u8bba\u4ece\u65b0\u5230\u65e7":"\u8bc4\u8bba\u4ece\u65e7\u5230\u65b0"})]})]}),this.props.showHeader&&Object(i.jsx)("div",{className:lt.a.input,children:Object(i.jsx)(qe.a,{height:"middle",onSubmit:function(e,t){return m.props.onPublishClick(e,t)},initValue:this.state.inputValue,placeholder:this.state.placeholder,onFocus:function(e){return m.onFocus(e)},onEmojiIconClick:function(){return m.onFocus()},onAtIconClick:function(){return m.onFocus()},onPcitureIconClick:function(){return m.onFocus()}})}),Object(i.jsx)("div",{className:lt.a.body,children:b.map((function(e,t){var n,a;return Object(i.jsx)("div",{className:"".concat(lt.a.commentItems," ").concat(t===b.length-1&&lt.a.isLastOne),ref:e.id===C?m.props.positionRef:null,children:Object(i.jsx)("div",{ref:10===t?m.comment10Ref:null,children:Object(i.jsx)(dt.a,{data:e,avatarClick:function(e){return m.onUserClick(e)},replyAvatarClick:function(t,n){return m.replyAvatarClick(t,e,n)},likeClick:function(){return m.likeClick(e)},replyClick:function(){return m.replyClick(e)},deleteClick:function(){return m.deleteClick(e)},editClick:function(){return m.editClick(e)},replyLikeClick:function(t){return m.replyLikeClick(t,e)},replyReplyClick:function(t){return m.replyReplyClick(t,e)},replyDeleteClick:function(t){return m.replyDeleteClick(t,e)},reportClick:function(){return m.reportClick(e)},onCommentClick:function(){return m.onCommentClick(e)},onSubmit:function(e,t){return m.createReply(e,t)},isShowOne:!0,isShowInput:m.state.commentId===e.id,onAboptClick:function(){return m.onAboptClick(e)},isShowAdopt:y&&O&&(null===(n=m.props.thread)||void 0===n||null===(a=n.threadData)||void 0===a?void 0:a.userId)!==e.userId,threadId:m.props.thread.threadData.userId,active:e.id===C,isAnonymous:D},e.id)})},e.id||t)}))}),Object(i.jsx)(q.a,{visible:this.state.showDeletePopup,onClose:function(){return m.setState({showDeletePopup:!1})},onBtnClick:function(){return m.deleteComment()}}),Object(i.jsx)(q.a,{visible:this.state.showReplyDeletePopup,onClose:function(){return m.setState({showReplyDeletePopup:!1})},onBtnClick:function(){return m.replyDeleteComment()}}),(null===g||void 0===g||null===(h=g.REWARD)||void 0===h?void 0:h.money)&&(null===g||void 0===g||null===(v=g.REWARD)||void 0===v?void 0:v.remainMoney)&&Object(i.jsx)(ut.a,{money:Number(g.REWARD.money),remainMoney:Number(g.REWARD.remainMoney),visible:this.state.showAboptPopup,onCancel:function(){return m.onAboptCancel()},onOkClick:function(e){return m.onAboptOk(e)}})]})}}]),n}(k.a.Component))||We)||We)||We)||We)||We;vt.defaultProps={showHeader:!0};var mt,ft=vt;function jt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var a=j()(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return m()(this,n)}}var bt,kt=Object(C.c)("site")(mt=Object(C.c)("user")(mt=Object(C.c)("thread")(mt=Object(C.c)("commentPosition")(mt=Object(C.c)("comment")(mt=Object(C.c)("index")(mt=Object(C.d)(mt=function(e){h()(n,e);var t=jt(n);function n(e){var i;return l()(this,n),(i=t.call(this,e)).state={showReportPopup:!1,showDeletePopup:!1,showCommentInput:!1,showMorePopup:!1,showRewardPopup:!1,isCommentLoading:!1,setTop:!1,inputValue:"",isBaseLayoutReady:!1},i.likedLoading=!1,i.collectLoading=!1,i.perPage=20,i.page=1,i.commentDataSort=!0,i.threadBodyRef=k.a.createRef(),i.commentDataRef=k.a.createRef(),i.position=0,i.comment=null,i.reportContent=["\u5e7f\u544a\u5783\u573e","\u8fdd\u89c4\u5185\u5bb9","\u6076\u610f\u704c\u6c34","\u91cd\u590d\u53d1\u5e16"],i.inputText="\u8bf7\u8f93\u5165\u5176\u4ed6\u7406\u7531",i.positionRef=k.a.createRef(),i.isPositioned=!1,i}return d()(n,[{key:"handleOnRefresh",value:function(){return this.props.thread.setCommentListPage(this.props.thread.page+1),this.loadCommentList()}},{key:"handleOnScroll",value:function(){var e,t,n,i,a=null===(e=this.threadBodyRef)||void 0===e||null===(t=e.current)||void 0===t||null===(n=t.listRef)||void 0===n||null===(i=n.current)||void 0===i?void 0:i.listWrapper;if(a&&a.current){var r,s=null===a||void 0===a||null===(r=a.current)||void 0===r?void 0:r.scrollTop;this.props.thread.setScrollDistance(s)}}},{key:"onBaseLayoutReady",value:function(){this.setState({isBaseLayoutReady:!0})}},{key:"componentDidUpdate",value:function(){var e,t,n=this;if(this.state.isBaseLayoutReady){var i,a,r,s,o=null===(i=this.threadBodyRef)||void 0===i||null===(a=i.current)||void 0===a||null===(r=a.listRef)||void 0===r||null===(s=r.current)||void 0===s?void 0:s.listWrapper;o&&this.scrollToPostion(o),this.setState({isBaseLayoutReady:!1})}null!==(e=this.props.commentPosition)&&void 0!==e&&e.postId&&!this.isPositioned&&null!==(t=this.positionRef)&&void 0!==t&&t.current&&(this.isPositioned=!0,setTimeout((function(){n.positionRef.current.scrollIntoView()}),1e3))}},{key:"componentWillUnmount",value:function(){}},{key:"scrollToPostion",value:function(e){var t;null===e||void 0===e||null===(t=e.current)||void 0===t||t.scrollTo(0,this.props.thread.scrollDistance)}},{key:"loadCommentList",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.props.thread.isCommentReady,!this.state.isCommentLoading&&i){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),a=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:a,page:this.props.thread.page,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.thread.loadCommentList(s);case 8:if(o=e.sent,c=o.success,l=o.msg,this.setState({isCommentLoading:!1}),!c){e.next=14;break}return e.abrupt("return");case 14:F.a.error({content:l});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSortChange",value:function(e){this.commentDataSort=e,this.props.thread.setCommentListPage(1),this.props.commentPosition.reset(),this.loadCommentList()}},{key:"onInputClick",value:function(){this.setState({showCommentInput:!0})}},{key:"onOperClick",value:function(e){if("stick"===e&&this.updateStick(),"essence"===e&&this.updateEssence(),"delete"===e&&this.setState({showDeletePopup:!0}),"edit"===e){var t,n,i,a;if(null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n||!n.id)return;this.props.router.push("/thread/post?id=".concat(null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id))}"report"===e&&this.setState({showReportPopup:!0})}},{key:"onReportClick",value:function(e){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.comment=e,this.setState({showReportPopup:!0})}},{key:"onReportOk",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return F.a.info({content:"\u8bf7\u9009\u62e9\u6216\u8f93\u5165\u4e3e\u62a5\u7406\u7531"}),e.abrupt("return");case 3:return n={threadId:this.props.thread.threadData.threadId,reason:t,userId:this.props.user.userInfo.id},this.comment?(n.type=2,n.postId=this.comment.id):n.type=1,e.next=7,this.props.thread.createReports(n);case 7:if(i=e.sent,a=i.success,s=i.msg,!a){e.next=14;break}return F.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),this.setState({showReportPopup:!1}),e.abrupt("return",!0);case 14:F.a.error({content:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReportCancel",value:function(){this.comment=null,this.setState({showReportPopup:!1})}},{key:"setTopState",value:function(e){var t=this;this.setState({showContent:e,setTop:!this.state.setTop}),setTimeout((function(){t.setState({setTop:!t.state.setTop})}),2e3)}},{key:"updateStick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,o={id:s,isStick:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(a=i.threadData)&&void 0!==a&&a.isStick)},e.next=4,this.props.thread.updateStick(o);case 4:if(c=e.sent,l=c.success,u=c.msg,!l){e.next=11;break}return this.setTopState(o.isStick),(null===(d=this.props)||void 0===d||null===(p=d.index)||void 0===p?void 0:p.refreshHomeData)&&this.props.index.refreshHomeData(),e.abrupt("return");case 11:F.a.error({content:u});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEssence",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,isEssence:!(null!==(i=this.props.thread)&&void 0!==i&&null!==(a=i.threadData)&&void 0!==a&&null!==(s=a.displayTag)&&void 0!==s&&s.isEssence)},e.next=4,this.props.thread.updateEssence(c);case 4:if(l=e.sent,u=l.success,d=l.msg,this.props.thread.updateListStore(),!u){e.next=11;break}return F.a.success({content:"\u64cd\u4f5c\u6210\u529f"}),e.abrupt("return");case 11:F.a.error({content:d});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showDeletePopup:!1}),i=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,e.next=4,this.props.thread.delete(i);case 4:if(a=e.sent,s=a.success,o=a.msg,!s){e.next=11;break}return F.a.success({content:"\u5220\u9664\u6210\u529f\uff0c\u5373\u5c06\u8df3\u8f6c\u81f3\u9996\u9875"}),setTimeout((function(){c.props.router.push("/")}),1e3),e.abrupt("return");case 11:F.a.error({content:o});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onBtnClick",value:function(){this.delete(),this.setState({showDeletePopup:!1})}},{key:"onPublishClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:"",n=i.length>1&&void 0!==i[1]?i[1]:[],this.props.user.isLogin()){e.next=6;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 6:if(t.replace(/\s/g,"")||0!==n.length){e.next=10;break}return F.a.info({content:"\u8bf7\u8f93\u5165\u5185\u5bb9"}),e.abrupt("return");case 10:if(!this.comment){e.next=16;break}return e.next=13,this.updateComment(t,n);case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,this.createComment(t,n);case 18:e.t0=e.sent;case 19:return e.abrupt("return",e.t0);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o,c,l,u,d,p,h,v,m,f,j;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id,l={id:c,content:t,sort:this.commentDataSort,isNoMore:null===(s=this.props)||void 0===s||null===(o=s.thread)||void 0===o?void 0:o.isNoMore,attachments:[]},null!==n&&void 0!==n&&n.length&&(l.attachments=n.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=5,this.props.comment.createComment(l,this.props.thread);case 5:if(u=e.sent,d=u.success,p=u.msg,h=u.isApproved,v=u.redPacketAmount,!d){e.next=19;break}return h?F.a.success({content:p}):F.a.warning({content:p}),v&&v>0&&this.props.thread.setRedPacket(v),this.props.thread.updatePostCount(this.props.thread.totalCount),this.props.thread.updateListStore(),(null===(m=this.props.thread)||void 0===m||null===(f=m.threadData)||void 0===f||null===(j=f.displayTag)||void 0===j?void 0:j.isRedPack)&&this.props.thread.fetchThreadDetail(c),this.setState({showCommentInput:!1,inputValue:""}),e.abrupt("return",!0);case 19:F.a.error({content:p});case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateComment",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.comment){e.next=2;break}return e.abrupt("return");case 2:return s=null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.id,o={id:s,postId:this.comment.id,content:t,attachments:[]},null!==n&&void 0!==n&&n.length&&(o.attachments=n.filter((function(e){return"success"===e.status&&e.response})).map((function(e){return{id:e.response.id,type:"attachments"}}))),e.next=7,this.props.comment.updateComment(o,this.props.thread);case 7:if(c=e.sent,l=c.success,u=c.msg,d=c.isApproved,!l){e.next=15;break}return d?F.a.success({content:u}):F.a.warning({content:u}),this.setState({showCommentInput:!1}),e.abrupt("return",!0);case 15:F.a.error({content:u});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEditClick",value:function(e){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.comment=e,this.setState({inputValue:e.content,showCommentInput:!0})}},{key:"onClose",value:function(){this.setState({showCommentInput:!1}),this.comment=null}},{key:"onLikeClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:if(!this.likedLoading){e.next=6;break}return e.abrupt("return");case 6:return this.likedLoading=!0,c=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,l={id:c,pid:null===(i=this.props.thread)||void 0===i||null===(a=i.threadData)||void 0===a?void 0:a.postId,isLiked:!(null!==(s=this.props.thread)&&void 0!==s&&null!==(o=s.threadData)&&void 0!==o&&o.isLike)},e.next=11,this.props.thread.updateLiked(l,this.props.index,this.props.user);case 11:u=e.sent,d=u.success,p=u.msg,this.likedLoading=!1,d||F.a.error({content:p});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onShareClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d,p,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F.a.info({content:"\u590d\u5236\u94fe\u63a5\u6210\u529f"}),o=(null===(t=this.props.thread)||void 0===t?void 0:t.threadData)||{},c=o.title,l=void 0===c?"":c,Y()({title:l,path:"thread/".concat(null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i?void 0:i.threadId)}),u=null===(a=this.props.thread)||void 0===a||null===(s=a.threadData)||void 0===s?void 0:s.id,e.next=6,this.props.thread.shareThread(u);case 6:d=e.sent,p=d.success,h=d.msg,p||F.a.error({content:h});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onCollectionClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:if(!this.collectLoading){e.next=6;break}return e.abrupt("return");case 6:return this.collectLoading=!0,a=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,s={id:a,isFavorite:!(null!==(i=this.props.thread)&&void 0!==i&&i.isFavorite)},e.next=11,this.props.thread.updateFavorite(s);case 11:o=e.sent,c=o.success,l=o.msg,this.collectLoading=!1,c||F.a.error({content:l});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onFollowClick",value:function(){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});var e,t,n,i;this.props.thread.threadData.userId&&(2===(null===(e=this.props.thread)||void 0===e||null===(t=e.authorInfo)||void 0===t?void 0:t.follow)||1===(null===(n=this.props.thread)||void 0===n||null===(i=n.authorInfo)||void 0===i?void 0:i.follow)?this.props.thread.cancelFollow({id:this.props.thread.threadData.userId,type:1},this.props.user):this.props.thread.postFollow(this.props.thread.threadData.userId,this.props.user))}},{key:"onPayClick",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.user.isLogin()){e.next=4;break}return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(W.a)({url:"/user/login"}),e.abrupt("return");case 4:return a=this.props.thread.threadData,e.next=7,Object(Z.a)(a,null===(t=this.props.user)||void 0===t?void 0:t.userInfo);case 7:if(s=e.sent,!s.success||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId){e.next=13;break}return e.next=12,this.props.thread.fetchThreadDetail(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.threadId);case 12:this.props.thread.updateListStore();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onRewardClick",value:function(){if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});this.setState({showRewardPopup:!0})}},{key:"onRewardSubmit",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c,l,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(isNaN(Number(t))||null===(n=this.props.thread)||void 0===n||null===(i=n.threadData)||void 0===i||!i.threadId||null===(a=this.props.thread)||void 0===a||null===(s=a.threadData)||void 0===s||!s.userId){e.next=9;break}return this.setState({showRewardPopup:!1}),l={amount:Number(t),threadId:this.props.thread.threadData.threadId,payeeId:this.props.thread.threadData.userId,title:(null===(o=this.props.thread)||void 0===o||null===(c=o.threadData)||void 0===c?void 0:c.title)||"\u4e3b\u9898\u6253\u8d4f"},e.next=5,this.props.thread.rewardPay(l,this.props.user,this.props.index);case 5:u=e.sent,d=u.success,p=u.msg,d||F.a.error({content:p});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTagClick",value:function(){var e,t,n=null===(e=this.props.thread)||void 0===e||null===(t=e.threadData)||void 0===t?void 0:t.categoryId;(n||"number"===typeof n)&&this.props.index.refreshHomeData({categoryIds:[n]}),this.props.router.push("/")}},{key:"onPrivateLetter",value:function(){var e;if(!this.props.user.isLogin())return F.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),void Object(W.a)({url:"/user/login"});var t=null===(e=this.props.thread)||void 0===e?void 0:e.authorInfo,n=t.username,i=t.nickname;n&&g.a.push({url:"/message?page=chat&username=".concat(n,"&nickname=").concat(i)})}},{key:"onUserClick",value:function(e){e&&g.a.push({url:"/user/".concat(e)})}},{key:"onLoadMoreClick",value:function(){this.props.commentPosition.page=this.props.commentPosition.page+1,this.loadCommentPositionList()}},{key:"loadCommentPositionList",value:function(){var e=o()(r.a.mark((function e(){var t,n,i,a,s,o,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.props.commentPosition.isCommentReady,!this.state.isCommentLoading&&s){e.next=3;break}return e.abrupt("return");case 3:return this.setState({isCommentLoading:!0}),o=null===(t=this.props.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.id,c={id:o,page:(null===(i=this.props)||void 0===i||null===(a=i.commentPosition)||void 0===a?void 0:a.page)||1,perPage:this.perPage,sort:this.commentDataSort?"createdAt":"-createdAt"},e.next=8,this.props.commentPosition.loadCommentList(c);case 8:if(l=e.sent,u=l.success,d=l.msg,this.setState({isCommentLoading:!1}),!u){e.next=14;break}return e.abrupt("return",!0);case 14:F.a.error({content:d});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderContent",value:function(){var e,t=this,n=this.props,a=n.thread,r=n.canPublish,s=a.isReady,o=a.isCommentReady,c=(a.isNoMore,a.totalCount,a.isCommentListError),l=1===((null===a||void 0===a||null===(e=a.threadData)||void 0===e?void 0:e.isApproved)||0),u=this.props.commentPosition,d=u.isShowCommentList,p=u.isNoMore;return Object(i.jsxs)("div",{className:Xe.a.bodyLeft,children:[s&&!l&&Object(i.jsx)("div",{className:Xe.a.examinePosition}),s?Object(i.jsx)(st,{store:a,onOperClick:function(e){return t.onOperClick(e)},onLikeClick:function(){return t.onLikeClick()},onCollectionClick:function(){return t.onCollectionClick()},onShareClick:function(){return t.onShareClick()},onRewardClick:function(){return t.onRewardClick()},onTagClick:function(){return t.onTagClick()},onPayClick:function(){return t.onPayClick()},onUserClick:function(){var e,n,i;return t.onUserClick(null===(e=t.props.thread)||void 0===e||null===(n=e.threadData)||void 0===n||null===(i=n.user)||void 0===i?void 0:i.userId)}}):Object(i.jsx)(L.a,{type:"init"}),Object(i.jsx)("div",{className:"".concat(Xe.a.bottom),children:o&&l?Object(i.jsxs)(b.Fragment,{children:[o&&d&&Object(i.jsxs)(b.Fragment,{children:[Object(i.jsx)(ft,{commentDataRef:this.commentDataRef,isPositionComment:!0,router:this.props.router,sort:function(e){return t.onSortChange(e)},replyAvatarClick:function(e,n,i){return t.replyAvatarClick(e,n,i)}}),!p&&Object(i.jsxs)("div",{className:Xe.a.showMore,onClick:function(){return t.onLoadMoreClick()},children:[Object(i.jsx)("div",{className:Xe.a.hidePercent,children:"\u5c55\u5f00\u66f4\u591a\u8bc4\u8bba"}),Object(i.jsx)(E.a,{className:Xe.a.icon,name:"RightOutlined",size:12})]})]}),Object(i.jsx)(ft,{canPublish:r,positionRef:this.positionRef,showHeader:!d,router:this.props.router,sort:function(e){return t.onSortChange(e)},onEditClick:function(e){return t.onEditClick(e)},onPublishClick:function(e,n){return t.onPublishClick(e,n)},onReportClick:function(e){return t.onReportClick(e)}})]}):l&&Object(i.jsx)(L.a,{isError:c,type:"init"})})]})}},{key:"renderRight",value:function(){var e,t,n,a,r,s,o,c=this,l=this.props.thread,u=l.isAuthorInfoError,d=l.isReady,p=1===((null===l||void 0===l||null===(e=l.threadData)||void 0===e?void 0:e.isApproved)||0),h=(null===(t=this.props.user)||void 0===t||null===(n=t.userInfo)||void 0===n?void 0:n.id)&&(null===(a=this.props.user)||void 0===a||null===(r=a.userInfo)||void 0===r?void 0:r.id)===(null===l||void 0===l||null===(s=l.threadData)||void 0===s?void 0:s.userId),v=null===l||void 0===l||null===(o=l.threadData)||void 0===o?void 0:o.isAnonymous;return Object(i.jsxs)("div",{className:"".concat(Xe.a.bodyRigth),children:[d&&!p&&Object(i.jsx)("div",{className:Xe.a.examinePosition}),!v&&Object(i.jsx)("div",{className:"".concat(Xe.a.authorInfo," detail-authorinfo"),children:null!==l&&void 0!==l&&l.authorInfo?Object(i.jsx)(_e.a,{user:l.authorInfo,onFollowClick:function(){return c.onFollowClick()},onPrivateLetter:function(){return c.onPrivateLetter()},onPersonalPage:function(){var e,t,n;return c.onUserClick(null===(e=c.props.thread)||void 0===e||null===(t=e.threadData)||void 0===t||null===(n=t.user)||void 0===n?void 0:n.userId)},isShowBtn:!h}):Object(i.jsx)(L.a,{type:"init",isError:u})}),Object(i.jsx)("div",{className:Xe.a.recommend,children:Object(i.jsx)(et.a,{})}),Object(i.jsx)("div",{className:Xe.a.qrcode,children:Object(i.jsx)(tt.a,{})}),Object(i.jsx)(Ve.a,{className:Xe.a.copyright})]})}},{key:"render",value:function(){var e,t,n,a,r,s,o,c,l,u,d,p,h,v,m,f,j,b,k=this,x=this.props.thread,C=x.isCommentReady,y=x.isNoMore,O=this.props.thread,D=O.isReady,w=1===((null===O||void 0===O||null===(e=O.threadData)||void 0===e?void 0:e.isApproved)||0),g=null===O||void 0===O||null===(t=O.threadData)||void 0===t?void 0:t.isAnonymous,N=(null===(n=this.props.user)||void 0===n||null===(a=n.userInfo)||void 0===a?void 0:a.id)&&(null===(r=this.props.user)||void 0===r||null===(s=r.userInfo)||void 0===s?void 0:s.id)===(null===O||void 0===O||null===(o=O.threadData)||void 0===o?void 0:o.userId);return Object(i.jsxs)("div",{children:[Object(i.jsx)(Ye,{showContent:null===(c=this.props.thread)||void 0===c||null===(l=c.threadData)||void 0===l?void 0:l.isStick,setTop:this.state.setTop}),Object(i.jsx)($e,{isShow:D&&!w}),Object(i.jsx)(Ke.a,{onRefresh:function(){return k.handleOnRefresh()},onScroll:function(){return k.handleOnScroll()},noMore:y,ref:this.threadBodyRef,showRefresh:!1,right:this.renderRight(),isShowLayoutRefresh:C,ready:function(){return k.onBaseLayoutReady()},rightClassName:I()(Xe.a.positionSticky,{"is-userinfo-show":!g,"is-operate-show":!N}),className:"detail",children:this.renderContent()}),Object(i.jsx)(ee.a,{position:"center",visible:this.state.showCommentInput,onClose:function(){return k.onClose()},children:Object(i.jsxs)("div",{className:Xe.a.editCmment,children:[Object(i.jsx)("div",{className:Xe.a.close,onClick:function(){return k.onClose()},children:Object(i.jsx)(E.a,{size:18,name:"WrongOutlined"})}),Object(i.jsx)("div",{className:Xe.a.title,children:"\u7f16\u8f91\u8bc4\u8bba"}),Object(i.jsx)("div",{className:Xe.a.user,children:Object(i.jsx)(ke.a,{name:(null===this||void 0===this||null===(u=this.comment)||void 0===u||null===(d=u.user)||void 0===d?void 0:d.nickname)||"",avatar:(null===this||void 0===this||null===(p=this.comment)||void 0===p||null===(h=p.user)||void 0===h?void 0:h.avatar)||"",time:"".concat(null===this||void 0===this||null===(v=this.comment)||void 0===v?void 0:v.updatedAt)||"",userId:null===this||void 0===this||null===(m=this.comment)||void 0===m||null===(f=m.user)||void 0===f?void 0:f.userId,platform:"pc"})}),Object(i.jsx)(qe.a,{height:"middle",onSubmit:function(e){return k.onPublishClick(e)},initValue:this.state.inputValue,threadId:null===(j=this.props.thread)||void 0===j||null===(b=j.threadData)||void 0===b?void 0:b.userId,isAnonymous:g})]})}),Object(i.jsx)(q.a,{visible:this.state.showDeletePopup,onClose:function(){return k.setState({showDeletePopup:!1})},onBtnClick:function(){return k.delete()},type:"thread"}),Object(i.jsx)(Je.a,{reportContent:this.reportContent,inputText:this.inputText,visible:this.state.showReportPopup,onCancel:function(){return k.onReportCancel()},onOkClick:function(e){return k.onReportOk(e)}}),Object(i.jsx)(He,{visible:this.state.showRewardPopup,onCancel:function(){return k.setState({showRewardPopup:!1})},onOkClick:function(e){return k.onRewardSubmit(e)}})]})}}]),n}(k.a.Component))||mt)||mt)||mt)||mt)||mt)||mt)||mt,xt=Object(x.withRouter)(kt),Ct=n("ZCww"),yt=n("L0er"),Ot=n("J0pL"),Dt=n("Tk/S"),wt=n("/Ugf"),gt=n("lF3x"),Nt=n("SRSl");function Rt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=j()(e);if(t){var a=j()(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return m()(this,n)}}var Pt=Object(C.c)("site")(bt=Object(C.c)("thread")(bt=Object(C.c)("commentPosition")(bt=Object(C.c)("user")(bt=Object(C.c)("index")(bt=Object(C.c)("threadList")(bt=Object(C.d)(bt=function(e){h()(n,e);var t=Rt(n);function n(e){var i;l()(this,n),(i=t.call(this,e)).updateViewCount=function(){var e=o()(r.a.mark((function e(t){var n,a,s,o,c,l,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.props.site,s=(null===a||void 0===a||null===(n=a.webConfig)||void 0===n?void 0:n.setSite)||{},o=s.openViewCount,c=Number(o),l=Number(t),e.next=6,Object(gt.c)(l,0===c);case 6:(u=e.sent)&&(i.props.thread.updateViewCount(u),Object(Nt.c)(l,{updateType:"viewCount",updatedInfo:{viewCount:u}}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.handleWeiXinShare=o()(r.a.mark((function e(){var t,n,a,s,o,c,l,u,d,p,h,v,m,f,j,b,k,x,C,y;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e){var i=Object(wt.a)(e);if(i)return i.length>28?"".concat(i.substr(0,28),"..."):i}var a=[];n[101]&&a.push("\u56fe\u7247"),n[103]&&a.push("\u89c6\u9891"),n[102]&&a.push("\u8bed\u97f3"),n[108]&&a.push("\u9644\u4ef6");var r=a.length>0?"".concat(a.join("/")):"\u5185\u5bb9",s=t&&t.nickname?"".concat(t.nickname):"\u533f\u540d\u7528\u6237";return"".concat(s,"\u53d1\u5e03\u7684").concat(r)},n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,a=null;if(1!==f){for(var r=t.match(/<img[\s]+[^<>]*>|<img[\s]+[^<>]*/g)||[],s=0;s<r.length;s++)if(-1===r[s].indexOf("qq-emotion")&&(a=r[s].match(/(http|https):\/\/.*?(webp|png|jpg|jpeg)/gi))){a=a?a[0]:null;break}if(2!==f&&!a&&n[101])for(var o=n[101].body||[],c=0;c<o.length;c++)if("gif"!==o[c].extension){a=o[c].thumbUrl;break}}return!j&&!a&&e&&e.avatar&&(a=e.avatar),!a&&i&&""!==i&&(a=i),a},a=i.props,s=a.site,o=a.thread,c=s.webConfig,l=c.setSite,u=l.siteHeaderLogo,d=l.siteIntroduction,p=o.threadData,h=p.content,v=p.title,m=p.user,f=p.payType,j=p.isAnonymous,b=h.text,k=h.indexes,x=d&&""!==d?d:"\u5728\u8fd9\u91cc\uff0c\u53d1\u73b0\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9",C=v&&""!==v?v:t(b,m,k),y=n(m,b,k,u),Object(Dt.a)(C,x,window.location.href,y)}catch(r){console.error("\u8bbe\u7f6e\u5206\u4eab\u9519\u8bef",r)}case 1:case"end":return e.stop()}}),e)}))),i.state={isServerError:!1,serverErrorMsg:""};var a=i.props,s=a.thread,c=a.serverThread;return(null===c||void 0===c?void 0:c.commentList)&&s.setCommentList(c.commentList),(null===c||void 0===c?void 0:c.totalCount)&&s.setTotalCount(c.totalCount),i}return d()(n,null,[{key:"getInitialProps",value:function(){var e=o()(r.a.mark((function e(t){var n,i,a,s,o,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===t||void 0===t||null===(n=t.query)||void 0===n?void 0:n.id,a={threadData:null,commentList:null,totalCount:0,authorInfo:null},!i){e.next=11;break}return e.next=5,Object(y.readThreadDetail)({params:{threadId:Number(i)}});case 5:return 0===(s=e.sent).code&&(a.threadData=s.data),e.next=9,Object(y.readCommentList)({params:{filter:{thread:Number(i)},sort:"createdAt",page:1,perPage:20}});case 9:0===(o=e.sent).code&&(a.commentList=(null===(c=o.data)||void 0===c?void 0:c.pageData)||[],a.totalCount=(null===(l=o.data)||void 0===l?void 0:l.totalCount)||0);case 11:return e.abrupt("return",{serverThread:a});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),d()(n,[{key:"componentDidUpdate",value:function(e){var t,n,i,a,r,s;(null!==(t=this.props.router)&&void 0!==t&&null!==(n=t.query)&&void 0!==n&&n.id&&this.props.router.query.id!==e.router.query.id&&(this.props.thread.reset(),this.getPageDate(this.props.router.query.id)),null!==(i=this.props.router)&&void 0!==i&&null!==(a=i.query)&&void 0!==a&&a.postId&&this.props.router.query.postId!==e.router.query.postId)&&this.getPositionComment(null===(r=this.props.router)||void 0===r||null===(s=r.query)||void 0===s?void 0:s.id,this.props.router.query.postId)}},{key:"componentDidMount",value:function(){var e=o()(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.router.query,n=t.id,i=t.postId,!n){e.next=5;break}return e.next=4,this.getPageDate(n,i);case 4:this.updateViewCount(n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPageDate",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o,c,l,u,d,p,h,v,m,f,j,b,k,x,C,y,O,D,w,N,R,P,I,S,L;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(i=this.props)&&void 0!==i&&null!==(a=i.thread)&&void 0!==a&&a.threadData&&this.hasMaybeCache()){e.next=21;break}return h=(null===(u=this.props.thread)||void 0===u?void 0:u.isPositionToComment)||!1,this.props.thread.reset({isPositionToComment:h}),e.next=5,this.props.thread.fetchThreadDetail(t);case 5:if(0===(v=e.sent).code){e.next=13;break}if(-4004!==v.code){e.next=10;break}return g.a.replace({url:"/404"}),e.abrupt("return");case 10:return v.code>-5e3&&v.code<-4e3&&this.setState({serverErrorMsg:v.msg}),this.setState({isServerError:!0}),e.abrupt("return");case 13:if(1===((null===(d=this.props.thread)||void 0===d||null===(p=d.threadData)||void 0===p?void 0:p.isApproved)||0)){e.next=21;break}if(x=null===(m=this.props.user)||void 0===m||null===(f=m.userInfo)||void 0===f?void 0:f.id,C=null===(j=this.props.thread)||void 0===j||null===(b=j.threadData)||void 0===b||null===(k=b.user)||void 0===k?void 0:k.userId,x&&C&&x===C){e.next=21;break}return F.a.info({content:"\u5185\u5bb9\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\u624d\u80fd\u6b63\u5e38\u663e\u793a!"}),g.a.redirect({url:"/"}),e.abrupt("return");case 21:return this.hasMaybeCache()&&(1===((null===(y=this.props.thread)||void 0===y||null===(O=y.threadData)||void 0===O?void 0:O.isApproved)||0)||this.getThreadDataFromList(t)),Object(le.a)()&&this.handleWeiXinShare(),e.next=25,this.getPositionComment(t,n);case 25:null!==(s=this.props)&&void 0!==s&&null!==(o=s.thread)&&void 0!==o&&o.commentList&&this.hasMaybeCache()&&!n||(this.props.thread.setCommentListPage((null===(D=this.props.commentPosition)||void 0===D?void 0:D.postsPositionPage)||1),w={id:t,page:this.props.thread.page},this.props.thread.loadCommentList(w)),null!==(c=this.props)&&void 0!==c&&null!==(l=c.thread)&&void 0!==l&&l.authorInfo&&this.hasMaybeCache()||(I=this.props.site,S=I.platform,L=null===(N=this.props.thread)||void 0===N||null===(R=N.threadData)||void 0===R||null===(P=R.user)||void 0===P?void 0:P.userId,"pc"===S&&L&&this.props.thread.fetchAuthorInfo(L));case 27:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getThreadDataFromList",value:function(){var e=o()(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&null!==(n=this.props.threadList.findAssignThreadInLists({threadId:Number(t)}))&&void 0!==n&&n.length&&n.forEach((function(e){e.data&&(e=e.data)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPositionComment",value:function(){var e=o()(r.a.mark((function e(t,n){var i,a,s,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||null===(i=this.props)||void 0===i||null===(a=i.commentPosition)||void 0===a||a.reset(),!t||!n){e.next=7;break}return this.props.commentPosition.setPostId(Number(n)),s={threadId:t,postId:n,pageSize:20},e.next=6,this.props.commentPosition.fetchPositionPosts(s);case 6:this.props.commentPosition.isShowCommentList&&(o={id:t},this.props.commentPosition.loadCommentList(o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"hasMaybeCache",value:function(){var e,t,n,i=this.props.router.query.id,a=null===(e=this.props)||void 0===e||null===(t=e.thread)||void 0===t||null===(n=t.threadData)||void 0===n?void 0:n.threadId;return i&&a&&Number(i)===a}},{key:"render",value:function(){var e,t,n,a,r,s,o,c,l,u=this.props,d=u.site,p=u.canPublish,h=d.platform,v=!0;return(null!==(e=this.props)&&void 0!==e&&null!==(t=e.thread)&&void 0!==t&&null!==(n=t.threadData)&&void 0!==n&&n.title||null!==(a=this.props)&&void 0!==a&&null!==(r=a.thread)&&void 0!==r&&null!==(s=r.threadData)&&void 0!==s&&null!==(o=s.content)&&void 0!==o&&o.text)&&(v=!1),this.state.isServerError?"h5"===h?Object(i.jsx)(yt.a,{text:this.state.serverErrorMsg}):Object(i.jsx)(Ct.a,{text:this.state.serverErrorMsg}):Object(i.jsx)(Ot.a,{h5:Object(i.jsx)(Ue,{}),pc:Object(i.jsx)(xt,{canPublish:p}),title:(null===(c=this.props)||void 0===c||null===(l=c.thread)||void 0===l?void 0:l.title)||"",showSiteName:v})}}]),n}(k.a.Component))||bt)||bt)||bt)||bt)||bt)||bt)||bt;t.default=Object(x.withRouter)(Object(Ae.a)(Pt))},ZCww:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("nKUr"),a=n("q1tI"),r=n("6csX"),s=n("5f2u"),o=n.n(s),c=n("z8Av"),l=n("wXCO");function u(e){var t=Object(a.useState)(e.text||"\u670d\u52a1\u5668\u9519\u8bef SERVER ERROR")[0];return Object(i.jsxs)("div",{className:r.a.page,children:[Object(i.jsx)(c.a,{}),Object(i.jsxs)("div",{className:r.a.body,children:[Object(i.jsx)("img",{className:r.a.icon,src:"/dzq-img/error.png"}),Object(i.jsx)("span",{className:r.a.text,children:t}),Object(i.jsx)(o.a,{onClick:function(){window.location.reload()},className:r.a.button,type:"primary",children:"\u70b9\u6211\u5237\u65b0"})]}),Object(i.jsx)("div",{className:r.a.footer,children:Object(i.jsx)(l.a,{})})]})}},c7hV:function(e,t,n){"use strict";var i=n("nKUr"),a=n("q1tI"),r=n("MCNy"),s=n.n(r),o=n("k8W2"),c=n.n(o),l=n("5f2u"),u=n.n(l),d=n("ZS9c"),p=n("TSYQ"),h=n.n(p);t.a=function(e){var t=e.visible,n=e.onSubmit,r=e.onClose,o=e.onOperClick,l=e.permissions,p=void 0===l?{}:l,v=e.statuses,m=void 0===v?{}:v,f=p.canEdit,j=p.canDelete,b=p.canEssence,k=p.canStick,x=p.canShare,C=p.canWxShare,y=p.canCollect,O=p.isAdmini,D=m.isEssence,w=m.isStick,g=m.isCollect,N=Object(a.useState)(D),R=N[0],P=N[1],I=Object(a.useState)(w),S=I[0],L=I[1],T=Object(a.useState)(g),E=T[0],A=T[1],M=Object(a.useMemo)((function(){return 1+f+j+b+k+x+y}),[f,j,b,k,x,y]);return Object(a.useEffect)((function(){P(D)}),[D]),Object(a.useEffect)((function(){L(w)}),[w]),Object(a.useEffect)((function(){A(g)}),[g]),Object(i.jsx)(c.a,{position:"bottom",visible:t,onClose:r,children:Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{className:d.a.container,children:Object(i.jsxs)("div",{className:h()(d.a.more,M<5&&d.a.flex),children:[f&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("edit")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"RedactOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u7f16\u8f91"})]}),j&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("delete")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"DeleteOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u5220\u9664"})]}),b&&Object(i.jsxs)("div",{className:h()(d.a.moreItem,R&&d.a.actived),onClick:function(){return o("essence")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"HotBigOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u7cbe\u534e"})]}),k&&Object(i.jsxs)("div",{className:h()(d.a.moreItem,S&&d.a.actived),onClick:function(){return o("stick")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"TopOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u7f6e\u9876"})]}),y&&Object(i.jsxs)("div",{className:h()(d.a.moreItem,E&&d.a.actived),onClick:function(){return o("collect")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"CollectFunOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u6536\u85cf"})]}),x&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("post")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"PictureOutlinedBig",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u751f\u6210\u6d77\u62a5"})]}),x&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("copylink")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"PaperClipOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u590d\u5236\u94fe\u63a5"})]}),C&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("wxshare")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"WeChatOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u5fae\u4fe1\u5206\u4eab"})]}),!O&&Object(i.jsxs)("div",{className:d.a.moreItem,onClick:function(){return o("report")},children:[Object(i.jsx)("div",{className:d.a.icon,children:Object(i.jsx)(s.a,{name:"WarnOutlined",size:20})}),Object(i.jsx)("div",{className:d.a.text,children:"\u4e3e\u62a5"})]})]})}),Object(i.jsx)("div",{className:d.a.button,children:Object(i.jsx)(u.a,{full:!0,onClick:n,className:d.a.cancel,type:"default",children:"\u53d6\u6d88"})})]})})}},tuZy:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/thread/[id]",function(){return n("TP+V")}])},woGs:function(e,t,n){"use strict";n("2B1R"),n("qePV");var i=n("nKUr"),a=n("o0o1"),r=n.n(a),s=(n("ls82"),n("yXPU")),o=n.n(s),c=n("q1tI"),l=n("wdT/"),u=n.n(l),d=n("k8W2"),p=n.n(d),h=n("5f2u"),v=n.n(h),m=n("7O/2"),f=n.n(m),j=n("BGqZ"),b=n.n(j),k=n("qtPy");t.a=function(e){var t=e.visible,n=e.onOkClick,a=e.onCancel,s=e.inputText,l=e.reportContent,d=void 0===l?[]:l,h=Object(c.useState)(""),m=h[0],j=h[1],x=Object(c.useState)(!1),C=x[0],y=x[1],O=function(){var e=o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(m.length>450)){e.next=3;break}return u.a.error({content:"\u4e3e\u62a5\u5185\u5bb9\u4e0d\u80fd\u5927\u4e8e450\u4e2a\u5b57\u7b26"}),e.abrupt("return");case 3:if("function"!==typeof n){e.next=14;break}return e.prev=4,e.next=7,n(m);case 7:e.sent&&j(""),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(p.a,{position:"bottom",visible:t,onClose:a,children:Object(i.jsxs)("div",{className:k.a.container,children:[Object(i.jsxs)("div",{className:k.a.header,children:[Object(i.jsx)("div",{className:k.a.title,children:"\u4e3e\u62a5"}),Object(i.jsx)("div",{className:k.a.reason,children:"\u8bf7\u9009\u62e9\u4e3e\u62a5\u7406\u7531"})]}),Object(i.jsxs)("div",{className:k.a.body,children:[Object(i.jsxs)(b.a.Group,{defaultValue:"5",onChange:function(e){return function(e){"other"===e?(y(!0),j("")):(y(!1),j(d[Number(e)]))}(e)},children:[d.map((function(e,t){return Object(i.jsxs)("div",{className:k.a.reportTitle,children:[Object(i.jsx)("div",{className:k.a.content,children:e}),Object(i.jsx)(b.a,{name:"".concat(t)})]},t)})),Object(i.jsxs)("div",{className:k.a.reportTitle,children:[Object(i.jsx)("div",{className:k.a.content,children:"\u5176\u4ed6"}),Object(i.jsx)(b.a,{name:"other"})]})]}),C?Object(i.jsx)("div",{className:k.a.textarea,children:Object(i.jsx)(f.a,{className:k.a.input,rows:5,showLimit:!0,value:m,onChange:function(e){return j(e.target.value)},placeholder:s})}):""]}),Object(i.jsxs)("div",{className:k.a.button,children:[Object(i.jsx)(v.a,{onClick:a,className:k.a.cancel,children:"\u53d6\u6d88"}),Object(i.jsx)(v.a,{onClick:O,className:k.a.ok,type:"primary",children:"\u786e\u5b9a"})]})]})})}}},[["tuZy",1,0,3,5,4,6,8,2]]]);