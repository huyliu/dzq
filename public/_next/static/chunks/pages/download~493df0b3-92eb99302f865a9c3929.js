_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[17],{"/Nde":function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return b})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return h}));var r=n("lSNA"),a=n.n(r),i=(n("o0o1"),n("ls82"),n("yXPU"),n("+3IH")),o=n("dJ22");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={Code:"common_0001",Message:"\u9700\u8981\u8865\u5145\u6635\u79f0"},d={Code:"common_0002",Message:"\u9700\u8981\u8865\u5145\u9644\u52a0\u4fe1\u606f"},l={Code:"common_0003",Message:"\u9700\u8981\u8865\u5145\u6635\u79f0\u548c\u9644\u52a0\u4fe1\u606f"},f=-4009,p=2,b=-4007,h=function(e){var t=e.webConfig.setSite;return"1"===(t=void 0===t?{}:t).openExtFields},v=function(e){if(function(e){var t=Object(i.a)(e,"data.isMissNickname",!1),n=10===Object(i.a)(e,"data.userStatus"),r=Object(i.a)(e,"data.accessToken","");if(-8e3!==e.code){var a=Object(i.a)(e,"data.uid","");if(Object(o.a)({accessToken:r}),n&&t)throw c({uid:a},l);if(t)throw c({uid:a},u);if(n)throw c({uid:a},d)}}(e),0===e.code||e.code===f||e.code===b){var t=e.code,n=Object(i.a)(e,"data.userStatus",0),r=Object(i.a)(e,"data.uid","");if(0===t&&n===p){var a=Object(i.a)(e,"data.accessToken","");Object(o.a)({accessToken:a}),t=n}if(t)throw{Code:t,Message:Object(i.a)(e,"data.rejectReason",""),uid:r}}}},"3QY5":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("X6IV"),a=n("m5TM"),i=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=r.a.get(a.c.ACCESS_TOKEN_NAME),o=new XMLHttpRequest;o.open("GET",e,!0),o.setRequestHeader("authorization","Bearer ".concat(i)),o.responseType="blob",o.send(),o.onload=function(){if(200===o.status&&n){var e=o.response,r=new FileReader;r.readAsDataURL(e),r.onload=function(e){var n=document.createElement("a");n.download=t,n.href=e.target.result,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}}}},"5MUC":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("QWBl"),n("sMBO"),n("T63A"),n("tkto"),n("FZtP");var r=n("J4zp"),a=n.n(r),i={101:"IMAGE",102:"VOICE",103:"VIDEO",104:"GOODS",105:"QA",106:"RED_PACKET",107:"REWARD",108:"VOTE",109:"VOTE_THREAD",110:"FILE",111:"QA_IMAGE",10002:"IFRAME"};function o(e){var t={plugin:{}};return e&&Object.keys(e)&&Object.entries(e).forEach((function(e){var n=a()(e,2)[1];if(n){var r=n.tomId,o=n.body;if(i[r])t[i[r]]=o;else{var s=(o||{})._plugin;s&&(t.plugin[s.name]={tomId:r,body:o})}}})),t}},"7zbd":function(e,t,n){"use strict";n.r(t);n("ma9I"),n("qePV"),n("rB9j"),n("EnZy");var r,a=n("nKUr"),i=n("o0o1"),o=n.n(i),s=(n("ls82"),n("yXPU")),c=n.n(s),u=n("lwsE"),d=n.n(u),l=n("W8MJ"),f=n.n(l),p=n("7W2i"),b=n.n(p),h=n("a1gu"),v=n.n(h),m=n("Nsbk"),g=n.n(m),w=n("q1tI"),O=n.n(w),y=n("kMSe"),j=n("wdT/"),P=n.n(j),k=n("RiVy"),x=n("B5JU"),S=n.n(x),C=n("sho3"),D=n("IvHc"),E=n("QcND"),I=n("3QY5"),A=n("5MUC");function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var a=g()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return v()(this,n)}}var U=Object(y.c)("user")(r=Object(y.d)(r=function(e){b()(n,e);var t=R(n);function n(e){var r;return d()(this,n),(r=t.call(this,e)).state={},r}return f()(n,[{key:"componentDidMount",value:function(){var e=c()(o.a.mark((function e(){var t,n,r,a,i,s,c,u,d,l,f,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.router.query.url){e.next=3;break}return e.abrupt("return");case 3:if(this.props.user.isLogin()){e.next=7;break}return P.a.info({content:"\u8bf7\u5148\u767b\u5f55!"}),Object(D.a)({url:"/user/login"}),e.abrupt("return");case 7:if(!Object(k.a)()){e.next=11;break}return P.a.info({content:"\u6682\u4e0d\u652f\u6301\u5fae\u4fe1\u5185\u4e0b\u8f7d"}),S.a.redirect({url:"/"}),e.abrupt("return");case 11:return t=this.props.router.asPath,n=decodeURI(t).split("?"),r="".concat(n[1].split("=")[1],"?").concat(n[2].split("&")[0],"&").concat(n[2].split("&")[1]),a=n[2].split("&"),i=a[2].split("=")[1],s=a[3].split("=")[1],c=Number(a[1].split("=")[1]),e.next=20,this.getCanDownloadAttachment(s);case 20:if(u=e.sent,d=u.canDownloadAttachment,l=u.attachment,d){e.next=27;break}return P.a.warning({content:"\u6682\u2f46\u6743\u9650\u4e0b\u8f7d\u9644\u4ef6"}),S.a.redirect({url:"/"}),e.abrupt("return");case 27:return f=this.getAttachmentLink(c,l),p={sign:a[0].split("=")[1],attachmentsId:c,isCode:1},e.next=31,this.downloadAttachmentStatus(p);case 31:e.sent&&(Object(I.a)(r,i,!1),window.location.href=f);case 33:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCanDownloadAttachment",value:function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.readThreadDetail)({params:{threadId:Number(t)}});case 2:if(0!==(n=e.sent).code){e.next=6;break}return c=Object(A.a)(null===n||void 0===n||null===(r=n.data)||void 0===r||null===(a=r.content)||void 0===a?void 0:a.indexes),e.abrupt("return",{canDownloadAttachment:null===n||void 0===n||null===(i=n.data)||void 0===i||null===(s=i.ability)||void 0===s?void 0:s.canDownloadAttachment,attachment:c&&c.VOTE});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAttachmentLink",value:function(e,t){for(var n=0;n<(null===t||void 0===t?void 0:t.length);n++)if(t[n].id===e)return t[n].url}},{key:"downloadAttachmentStatus",value:function(){var e=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.readDownloadAttachmentStatus)(t);case 2:if(0!==(null===(n=e.sent)||void 0===n?void 0:n.code)){e.next=6;break}return S.a.redirect({url:"/"}),e.abrupt("return",!0);case 6:return-7083===(null===n||void 0===n?void 0:n.code)&&(P.a.info({content:null===n||void 0===n?void 0:n.msg}),S.a.redirect({url:"/"})),-7082===(null===n||void 0===n?void 0:n.code)&&(P.a.info({content:null===n||void 0===n?void 0:n.msg}),S.a.redirect({url:"/"})),-4004===(null===n||void 0===n?void 0:n.code)&&P.a.info({content:null===n||void 0===n?void 0:n.msg}),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(a.jsx)("div",{})}}]),n}(O.a.Component))||r)||r;t.default=Object(E.a)(U)},IvHc:function(e,t,n){"use strict";var r=n("lN2P");t.a=r.a.saveAndLogin},JTJg:function(e,t,n){"use strict";var r=n("I+eb"),a=n("WjRb"),i=n("HYAF");r({target:"String",proto:!0,forced:!n("qxPZ")("includes")},{includes:function(e){return!!~String(i(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},QcND:function(e,t,n){"use strict";n.d(t,"a",(function(){return ie}));n("ma9I"),n("yq1k"),n("4mDm"),n("Rfxz"),n("07d7"),n("rB9j"),n("JTJg"),n("PKPk"),n("Rm1S"),n("UxlC"),n("3bBZ"),n("Kz25");var r=n("nKUr"),a=n("o0o1"),i=n.n(a),o=n("lSNA"),s=n.n(o),c=(n("ls82"),n("yXPU")),u=n.n(c),d=n("lwsE"),l=n.n(d),f=n("PJYZ"),p=n.n(f),b=n("W8MJ"),h=n.n(b),v=n("7W2i"),m=n.n(v),g=n("a1gu"),w=n.n(g),O=n("Nsbk"),y=n.n(O),j=n("q1tI"),P=n.n(j),k=n("kMSe"),x=n("n4oF"),S=n("zDaA"),C=n("sho3"),D=n("B5JU"),E=n.n(D),I=n("20a2"),A=n("bK+J"),R=n("/Nde"),U=n("MCNy"),N=n.n(U),M=n("pGE/"),T=n("Tk/S"),W="rKwiNl2JOBH1dcaoggUsN",_="_3_kaucwAnhguPyKqHJUwsL",L=(n("5s+n"),n("RIqP")),q=n.n(L),B=n("rGXy"),J=n("lY1M");function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var X=["closeWindow","chooseImage","uploadImage","getLocalImgData","updateAppMessageShareData","updateTimelineShareData","getNetworkType"],z=!1;function H(){return K.apply(this,arguments)}function K(){return(K=u()(i.a.mark((function e(){var t,n,r,a,o,s,c=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]&&c[0],n=c.length>1&&void 0!==c[1]?c[1]:[],J.b.env("weixin")){e.next=4;break}return e.abrupt("return");case 4:return r=[],window.wx&&wx.config||(a=new Promise((function(e){var t=document.createElement("script");t.src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js",t.onload=function(){return e()},document.body.appendChild(t)})),r.push(a)),e.next=8,Promise.all(r);case 8:if(t&&!z){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,Object(B.getWXConfig)({params:{url:encodeURIComponent(window.location.href)}});case 12:if(0!==(o=e.sent).code||!o.data||!o.data.appId){e.next=21;break}return i=o.data,s={appId:i.appId,timestamp:i.timestamp,nonceStr:i.nonceStr,signature:i.signature},wx&&wx.config(Q(Q({debug:!1},s),{},{jsApiList:[].concat(X,q()(n))})),wx&&(wx.hasDoneConfig=!0),z=!0,e.abrupt("return",!0);case 21:console.error("\u521d\u59cb\u5316\u5fae\u4fe1jssdk\u5931\u8d25\uff01",o);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}var i}),e)})))).apply(this,arguments)}n("QWBl"),n("tkto"),n("FZtP");var V=n("lN2P"),G="/thread/post",Y="/indexPages/thread/post/index";function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.includes("?"),r=e;return Object.keys(t).forEach((function(e,a){r+="".concat(n||0!==a?"&":"?").concat(e,"=").concat(t[e])})),r}function $(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e.isLogin())return V.a.saveAndLogin(),!1;if(!t.publishNeedBindPhone&&!t.publishNeedBindWechat)return!0;var a="bind".concat(t.publishNeedBindPhone&&!e.mobile?"Mobile":"").concat(t.publishNeedBindWechat&&!e.isBindWechat?"Wechat":""),i="".concat(t.isSmsOpen?"mobile":"").concat("none"!==t.wechatEnv?"wechat":""),o="",s="",c={limitPublishType:n};if("h5"===t.platform){switch(n){case"comment":if("miniProgram"===t.wechatEnv){s="".concat(window.location.origin).concat(Y);break}s="".concat(window.location.origin).concat(G);break;case"reply":if("miniProgram"===t.wechatEnv){s="/indexPages/thread/index?id=".concat(r);break}V.a.saveCurrentUrl(),s=V.a.getUrl()}(s=encodeURIComponent(s))&&(c.toPage=s)}switch(i){case"mobile":o=e.mobile?"":Z("/user/bind-phone",c);break;case"wechat":o=e.isBindWechat?"":Z("/user/wx-bind-qrcode",c);break;case"mobilewechat":switch(a){case"bindMobile":o=e.mobile?"":Z("/user/bind-phone",c);break;case"bindWechat":o=e.isBindWechat?"":Z("/user/wx-bind-qrcode",c);break;case"bindMobileWechat":c.bindPhone=1,o=e.isBindWechat||e.mobile?"":Z("/user/wx-bind-qrcode",c)}}return o&&V.a.saveAndPush(o),"comment"===n&&V.a.setUrl("".concat(window.location.origin).concat(G)),!o}var ee=n("yO9+"),te=10;function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var a=y()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}function ie(e,t){var n,a=Object(k.c)("site")(n=Object(k.c)("user")(n=Object(k.c)("thread")(n=Object(k.c)("emotion")(n=Object(k.c)("commonLogin")(n=Object(k.d)(n=function(n){m()(o,n);var a=ae(o);function o(e){var t,n;l()(this,o),(t=a.call(this,e)).handleWxShare=t.handleWxShare.bind(p()(t)),t.canPublish=t.canPublish.bind(p()(t));var r=e.serverUser,i=e.serverSite,s=e.serverEmotion,c=e.user,u=e.site,d=e.emotion;return i&&i.platform&&u.setPlatform(i.platform),i&&i.closeSite&&u.setCloseSiteConfig(i.closeSite),i&&i.webConfig&&u.setSiteConfig(i.webConfig),r&&r.userInfo&&c.setUserInfo(r.userInfo),r&&r.userPermissions&&c.setUserPermissions(r.userPermissions),r&&r.userPermissions&&c.setUserPermissions(r.userPermissions),s&&s.emojis&&d.setEmoji(s.emojis),n=Object(x.a)()?!i:!(u&&u.webConfig),t.state={isNoSiteData:n,isPass:!1},t}return h()(o,null,[{key:"getInitialProps",value:function(){var t=u()(i.a.mark((function t(n){var r,a,o,s,c,u,d,l,f,p,b;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r="static",a={},c={},!Object(x.a)()){t.next=25;break}return b=n.req.headers,r=b&&!M.a.isEmptyObject(b)?Object(S.a)(b["user-agent"]):"static",Object(C.readEmoji)({},n),t.next=10,Object(C.readForum)({},n);case 10:if(a=t.sent,s={platform:r,closeSite:-3005===a.code?a.data:null,webConfig:a&&a.data||null},!a||0!==a.code||null===(l=a)||void 0===l||null===(f=l.data)||void 0===f||null===(p=f.user)||void 0===p||!p.userId){t.next=21;break}return t.next=15,Object(C.readUser)({params:{userId:a.data.user.userId}},n);case 15:return o=t.sent,t.next=18,Object(C.readPermissions)({},n);case 18:d=t.sent,u=o&&0===o.code?o.data:null,d=d&&0===d.code?d.data:null;case 21:if(!a||0!==a.code||!e.getInitialProps){t.next=25;break}return t.next=24,e.getInitialProps(n,{user:u,site:s});case 24:c=t.sent;case 25:return t.abrupt("return",re(re({},c),{},{serverSite:s,serverUser:{userInfo:u,userPermissions:d}}));case 28:return t.prev=28,t.t0=t.catch(0),console.log("err",t.t0),t.abrupt("return",{serverSite:{},serverUser:{}});case 32:case"end":return t.stop()}}),t,null,[[0,28]])})));return function(e){return t.apply(this,arguments)}}()}]),h()(o,[{key:"componentDidMount",value:function(){var e=u()(i.a.mark((function e(){var n,r,a,o,s,c,u,d,l,f,p,b,h,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.state.isNoSiteData,a=this.props,o=a.serverUser,s=a.serverSite,c=a.user,u=a.site,d=a.emotion,f=!1,null!==(n=d.emojis)&&void 0!==n&&n.length||d.fetchEmoji(),u.setPlatform(Object(S.a)(window.navigator.userAgent)),!r){e.next=16;break}if(l=(null===s||void 0===s?void 0:s.webConfig)||null){e.next=14;break}return e.next=10,Object(C.readForum)({});case 10:(p=e.sent).data&&u.setSiteConfig(p.data),this.setAppCommonStatus(p),l=p.data||null;case 14:e.next=17;break;case 16:l=u?u.webConfig:null;case 17:if(u.initUserLoginEntryStatus(),!l||!l.user){e.next=34;break}if(c&&c.userInfo||o&&o.userInfo){e.next=31;break}return e.next=22,Object(C.readUser)({params:{userId:l.user.userId}});case 22:return b=e.sent,e.next=25,Object(C.readPermissions)({});case 25:0===(h=e.sent).code&&h.data&&c.setUserPermissions(h.data),b.data&&c.setUserInfo(b.data),f=!!b.data,e.next=32;break;case 31:f=!0;case 32:e.next=35;break;case 34:f=!1;case 35:return c.updateLoginStatus(f),v=this.isPass(),t&&v&&(v=t(v)),this.setState({isPass:v}),e.next=41,H(l&&l.passport&&l.passport.offiaccountOpen);case 41:e.sent&&(this.handleWxShare(this.props.router.asPath),this.props.router.events.on("routeChangeComplete",this.handleWxShare));case 43:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleWxShare",value:function(e){if(window.wx&&window.wx.hasDoneConfig){var t=this.props,n=t.user,r=t.site,a=n.userInfo,i=r.webConfig.setSite,o=i.siteName,s=i.siteIntroduction,c=i.siteHeaderLogo,u=i.siteFavicon,d=a||{},l=d.nickname,f=d.avatarUrl,p=d.signature,b=d.id,h=document.title,v=s?s.length>35?"".concat(s.substr(0,35),"..."):s:"\u5728\u8fd9\u91cc\uff0c\u53d1\u73b0\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9",m=window.location.href,g=c||u;e.match(/\/thread\/\d+/)||e.match(/\/user\/\d+/)||("/my"===e&&l&&(h="".concat(l,"\u7684\u4e3b\u9875"),g=f,v=p?p.length>35?"".concat(p.substr(0,35),"..."):p:"\u5728\u8fd9\u91cc\uff0c\u53d1\u73b0\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9",m="".concat(window.location.origin,"/user/").concat(b)),(e.includes("/forum/partner-invite")||e.match(/\/user\/(username|wx|phone)-login/)||e.includes("/user/register"))&&(h="\u9080\u8bf7\u60a8\u52a0\u5165".concat(o)),(e.includes("/invite")||"/"===e)&&(h="".concat(l,"\u9080\u8bf7\u60a8\u52a0\u5165").concat(o)),e.includes("/message?page=chat")&&(h="\u6211\u7684\u79c1\u4fe1 - ".concat(o),m="".concat(window.location.origin,"/message")),Object(T.a)(h,v,m,g))}}},{key:"setAppCommonStatus",value:function(e){var t=this.props.site;switch([ee.j,ee.m,ee.g,ee.l,ee.h,ee.n,ee.k].includes(e.code)&&V.a.saveCurrentUrl(),e.code){case 0:break;case ee.u:t.setCloseSiteConfig(e.data),E.a.redirect({url:"/close"});break;case ee.e:break;case ee.w:Object(A.a)(),window.location.reload();break;case ee.f:E.a.redirect({url:"/404"});break;case ee.j:Object(A.a)(),V.a.gotoLogin();break;case ee.m:Object(A.a)(),V.a.saveAndRedirect("/user/register");break;case ee.g:E.a.push({url:"/user/status?statusCode=2"});break;case ee.l:E.a.push({url:"/user/status?statusCode=-4007"});break;case ee.h:E.a.push({url:"/user/status?statusCode=-4009"});break;case ee.n:V.a.saveAndRedirect("/user/supplementary");break;case ee.i:E.a.redirect({url:"/"});break;case ee.k:V.a.saveAndRedirect("/forum/partner-invite");break;default:t.setErrPageType("site"),E.a.redirect({url:"/500"})}}},{key:"checkJump",value:function(){var e=this.props.router,t=V.a.getUrl();if(t)if(new URL(t).pathname===e.asPath)V.a.clear();else if("/"===e.asPath)return V.a.restore(),!1;return!0}},{key:"isPass",value:function(){var e=this.props,t=e.site,n=e.router,r=e.user,a=e.commonLogin,i=this.state.isNoSiteData;if(t&&t.webConfig){var o,s;if(i&&this.setState({isNoSiteData:!1}),"/close"!==n.asPath&&t.closeSiteConfig)return E.a.redirect({url:"/close"}),!1;if(r.isLogin()){if(!t.isOffiaccountOpen&&!t.isMiniProgramOpen&&"/user/bind-phone"!==n.asPath&&t.isSmsOpen&&!r.mobile)return V.a.saveAndRedirect("/user/bind-phone"),!1;if("/user/bind-nickname"!==n.asPath&&!r.nickname)return a.needToCompleteExtraInfo=r.userStatus===te,V.a.saveAndRedirect("/user/bind-nickname"),!1;if(r.userStatus===R.b&&!ee.t.includes(n.pathname))return E.a.replace({url:"/user/status?statusCode=".concat(r.userStatus)}),!1}if("pay"===(null===t||void 0===t||null===(o=t.webConfig)||void 0===o||null===(s=o.setSite)||void 0===s?void 0:s.siteMode)){if(ee.x.some((function(e){return n.asPath.match(e)})))return this.checkJump(),!0;var c=n.query.inviteCode,u=c?"?inviteCode=".concat(c):"";if(null===r||void 0===r||!r.paid)return V.a.saveAndRedirect("/forum/partner-invite".concat(u)),!1}}return this.checkJump()}},{key:"filterProps",value:function(e){var t=re({},e);return delete t.serverUser,delete t.serverSite,delete t.user,delete t.site,t}},{key:"canPublish",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.props,r=n.user,a=n.site,i=n.thread;return $(r,a,t,null===i||void 0===i||null===(e=i.threadData)||void 0===e?void 0:e.threadId)}},{key:"render",value:function(){var t=this.state,n=t.isNoSiteData,a=t.isPass;return"static"===this.props.site.platform?null:n||!a?Object(r.jsx)("div",{className:W,children:Object(r.jsx)(N.a,{className:_,name:"LoadingOutlined",size:"large"})}):Object(r.jsx)(e,re({canPublish:this.canPublish},this.filterProps(this.props)))}}]),o}(P.a.Component))||n)||n)||n)||n)||n)||n;return Object(I.withRouter)(a)}},RiVy:function(e,t,n){"use strict";function r(){if("undefined"===typeof window)return!1;var e=window.navigator.userAgent.toLowerCase();return/micromessenger/.test(e)}n.d(t,"a",(function(){return r}))},"Tk/S":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("lY1M");function a(e,t,n,a){r.b.env("weixin")&&window.wx&&window.wx.ready((function(){var r={title:e||"Discuz! Q",desc:t&&""!=t?t:e||"Discuz! Q",link:n||window.location.href,imgUrl:a};wx.updateAppMessageShareData(r),wx.updateTimelineShareData(r)}))}},"o6+f":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/download",function(){return n("7zbd")}])},rGXy:function(e,t,n){"use strict";var r=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.getWXConfig=function(){return p.apply(this,arguments)};var a=r(n("o0o1")),i=r(n("lSNA")),o=r(n("QILm"));n("ls82");var s=r(n("yXPU")),c=n("0QFe"),u=r(n("m4Ii"));function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={messageText:{type:"string",required:!0},recipientUsername:{type:"string",required:!0},imageUrl:{type:"string"},attachmentId:{type:"number"}};function p(){return(p=(0,s.default)(a.default.mark((function e(){var t,n,r,i,s,d,p,b,h=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:{},e.prev=1,n=t.params,r=void 0===n?{}:n,i=t.data,s=void 0===i?{}:i,d=(0,o.default)(t,["params","data"]),p=l(l({url:"/apiv3/offiaccount/jssdk",method:"GET",params:r,data:s},d),{},{validateRules:f}),e.next=6,u.default.dispatcher(p);case 6:return b=e.sent,e.abrupt("return",b);case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",(0,c.handleError)(e.t0));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}},yq1k:function(e,t,n){"use strict";var r=n("I+eb"),a=n("TWQb").includes,i=n("RNIs");r({target:"Array",proto:!0,forced:!n("rkAj")("indexOf",{ACCESSORS:!0,1:0})},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},zDaA:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("n4oF");function a(e){var t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?"h5":"pc";if(!Object(r.a)()){var n=90===Math.abs(window.orientation),a=window.innerWidth;"pc"===t&&a<800&&(t="h5"),"h5"===t&&!n&&a>=800&&(t="pc")}return t}}},[["o6+f",1,0,3,4,2]]]);